/*!
* d3-node-editor v0.7.3
* (c) 2018 Vitaliy Stoliarov
* Released under the MIT License.
*/
!function(t){"use strict";function e(t,e,n,o){var i=e&&e.prototype instanceof r?e:r,u=Object.create(i.prototype),a=new h(o||[]);return u._invoke=s(t,n,a),u}function n(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function r(){}function o(){}function i(){}function u(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function a(t){function e(r,o,i,u){var a=n(t[r],t,o);if("throw"!==a.type){var s=a.arg,c=s.value;return c&&"object"==typeof c&&y.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,i,u)},function(t){e("throw",t,i,u)}):Promise.resolve(c).then(function(t){s.value=t,i(s)},u)}u(a.arg)}function r(t,n){function r(){return new Promise(function(r,o){e(t,n,r,o)})}return o=o?o.then(r,r):r()}var o;this._invoke=r}function s(t,e,r){var o=O;return function(i,u){if(o===N)throw new Error("Generator is already running");if(o===T){if("throw"===i)throw u;return p()}for(r.method=i,r.arg=u;;){var a=r.delegate;if(a){var s=c(a,r);if(s){if(s===A)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===O)throw o=T,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=N;var l=n(t,e,r);if("normal"===l.type){if(o=r.done?T:j,l.arg===A)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=T,r.method="throw",r.arg=l.arg)}}}function c(t,e){var r=t.iterator[e.method];if(r===v){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=v,c(t,e),"throw"===e.method))return A;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var o=n(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,A;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=v),e.delegate=null,A):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,A)}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function f(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function h(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function d(t){if(t){var e=t[w];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(y.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=v,e.done=!0,e};return r.next=r}}return{next:p}}function p(){return{value:v,done:!0}}var v,m=Object.prototype,y=m.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},w=g.iterator||"@@iterator",b=g.asyncIterator||"@@asyncIterator",x=g.toStringTag||"@@toStringTag",k="object"==typeof module,E=t.regeneratorRuntime;if(E)return void(k&&(module.exports=E));E=t.regeneratorRuntime=k?module.exports:{},E.wrap=e;var O="suspendedStart",j="suspendedYield",N="executing",T="completed",A={},G={};G[w]=function(){return this};var C=Object.getPrototypeOf,V=C&&C(C(d([])));V&&V!==m&&y.call(V,w)&&(G=V);var _=i.prototype=r.prototype=Object.create(G);o.prototype=_.constructor=i,i.constructor=o,i[x]=o.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,i):(t.__proto__=i,x in t||(t[x]="GeneratorFunction")),t.prototype=Object.create(_),t},E.awrap=function(t){return{__await:t}},u(a.prototype),a.prototype[b]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,o){var i=new a(e(t,n,r,o));return E.isGeneratorFunction(n)?i:i.next().then(function(t){return t.done?t.value:i.next()})},u(_),_[x]="Generator",_[w]=function(){return this},_.toString=function(){return"[object Generator]"},E.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},E.values=d,h.prototype={constructor:h,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(f),!t)for(var e in this)"t"===e.charAt(0)&&y.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,r){return i.type="throw",i.arg=t,n.next=e,r&&(n.method="next",n.arg=v),!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var u=y.call(o,"catchLoc"),a=y.call(o,"finallyLoc");if(u&&a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&y.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,A):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),A},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),f(n),A}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;f(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:d(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=v),A}}}(function(){return this}()||Function("return this")()),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3"),require("alight")):"function"==typeof define&&define.amd?define(["exports","d3","alight"],e):e(t.D3NE={},t.d3,t.alight)}(this,function(t,e,n){"use strict";function r(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=r(t[0],e);return t.every(function(t){return r(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return r(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var o=Object.keys(t);if(!o.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var i="  ".repeat(e-1),u=o.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+r(t[n],e)+";"}).join("\n  "+i);return o.length>=15&&(u+="\n  "+i+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}function o(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=o(t[0],e);return t.every(function(t){return o(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return o(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var i="  ".repeat(e-1),u=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+o(t[n],e)+";"}).join("\n  "+i);return r.length>=15&&(u+="\n  "+i+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}function i(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=i(t[0],e);return t.every(function(t){return i(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return i(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),u=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+i(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(u+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+u+"\n"+o+"}":"{\n  "+o+u+"\n"+o+"}"}function u(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=u(t[0],e);return t.every(function(t){return u(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return u(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),i=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+u(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(i+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}function a(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=a(t[0],e);return t.every(function(t){return a(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return a(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),i=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+a(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(i+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}function s(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=s(t[0],e);return t.every(function(t){return s(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return s(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),i=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+s(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(i+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}function c(t,n,r,o){function i(t,e,n){var r=this.editor.view.translateExtent,o=r[0][0],i=r[0][1],u=r[1][0],a=r[1][1];t.position[0]=Math.min(u,Math.max(o,t.position[0]+e)),t.position[1]=Math.min(a,Math.max(i,t.position[1]+n))}var u=this,a=o.changeDetector.locals.group;a.el=n,o.watch("group.style",function(){Object.assign(n.style,a.style)},{deep:!0}),e.select(n).call(e.drag().on("start",function(){e.event.sourceEvent.shiftKey||u.editor.selectGroup(a,e.event.sourceEvent.ctrlKey)}).on("drag",function(){if(!u.editor.readOnly){var t=u.transform.k,n=e.event.dx/t,r=e.event.dy/t;u.editor.selected.each(function(t){i.call(u,t,n,r)}),u.editor.selected.eachGroup(function(t){for(var e in t.nodes){var o=t.nodes[e];u.editor.selected.contains(o)||i.call(u,o,n,r)}}),u.update()}}).on("end",function(){u.editor.eventListener.trigger("change")}));var s={"Remove group":function(){u.editor.removeGroup(a)}},c=function(t){t.call(u),u.contextMenu.hide()};e.select(n).on("contextmenu",function(){if(!u.editor.readOnly){var t=e.event.clientX,n=e.event.clientY;u.editor.selectGroup(a),u.contextMenu.show(t,n,s,!1,c),e.event.preventDefault()}})}function l(t,n,r,o){function i(t,e,n,o,i){0!==e&&(s[0]=t[0]),0!==n&&(s[1]=t[1]),r.match("l")?(a.position[0]+=Math.min(e,o),a.setWidth(a.width-o)):r.match("r")&&a.setWidth(a.width+o),r.match("t")?(a.position[1]+=Math.min(n,i),a.setHeight(a.height-i)):r.match("b")&&a.setHeight(a.height+i)}var u=this,a=o.changeDetector.locals.group,s=null;e.select(n).call(e.drag().on("start",function(){s=e.mouse(u.container.node()),u.editor.selectGroup(a)}).on("drag",function(){if(!u.editor.readOnly){var t=e.zoomTransform(u.container),n=e.mouse(u.container.node()),r=(n[0]-s[0])/t.k,o=(n[1]-s[1])/t.k;i(n,Math.max(0,a.width-a.minWidth),Math.max(0,a.height-a.minHeight),r,o),u.update()}}).on("end",function(){u.editor.nodes.forEach(function(t){a.isCoverNode(t)?a.addNode(t):a.removeNode(t)}),u.editor.eventListener.trigger("change"),u.update()}))}function f(t,n,r,o){var i=o.changeDetector.locals.group;e.select(n).on("click",function(){var t=prompt("Please enter title of the group",i.title);null!==t&&t.length>0&&(i.title=t),o.scan()})}function h(t,n,r,o){function i(){if(null===this.pickedOutput)return s.hasConnection()&&(this.pickedOutput=s.connections[0].output,this.editor.removeConnection(s.connections[0])),this.update(),!0}function u(){var t=this;if(!s.multipleConnections&&s.hasConnection()&&this.editor.removeConnection(s.connections[0]),!this.pickedOutput.multipleConnections&&this.pickedOutput.hasConnection()&&this.editor.removeConnection(this.pickedOutput.connections[0]),this.pickedOutput.connectedTo(s)){var e=s.connections.find(function(e){return e.output===t.pickedOutput});this.editor.removeConnection(e)}this.editor.connect(this.pickedOutput,s)}var a=this,s=o.changeDetector.locals.input;s.el=n;var c=!1;e.select(n).on("mouseleave",function(){return c=!1}),e.select(n).on("mousedown mouseup",function(){a.editor.readOnly||c||(e.event.preventDefault(),e.event.stopPropagation(),i.call(a)||(u.call(a),a.pickedOutput=null,a.update()))}),e.select(n).on("mousedown.prevent",function(){return c=!0})}function d(t,n,r,o){var i=this,u=o.changeDetector.locals.output;u.el=n,e.select(n).on("mousedown",function(){i.editor.readOnly||(e.event.stopPropagation(),i.pickedOutput=u)})}function p(t,e,n){t.dataset.inputNode=e.node.id,t.dataset.inputIndex=e.node.inputs.indexOf(e),t.dataset.outputNode=n.node.id,t.dataset.outputIndex=n.node.outputs.indexOf(n),t.className.baseVal+=" output-"+n.socket.id.toLowerCase().replace(" ","-"),t.className.baseVal+=" input-"+e.socket.id.toLowerCase().replace(" ","-")}function v(t,e,n,r){var o=r.changeDetector.locals.path,i=o.connection;if(i){i.el=e,r.watch("path.connection.style",function(){Object.assign(e.style,i.style)},{deep:!0});var u=o.connection.input,a=o.connection.output;p(e,u,a)}}function m(t,e,n,r){var o=r.changeDetector.locals,i=o.input?o.input.control:o.control;e.innerHTML=i.html,i.handler(e.children[0],i)}function y(t,n,r,o){var i=this,u=o.changeDetector.locals,a=u.subitem||u.item,s=a.constructor===Object;e.select(n).on("click",function(){s||i.onClick(a),e.event.stopPropagation()}).classed("have-subitems",s)}function g(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=g(t[0],e);return t.every(function(t){return g(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return g(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),i=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+g(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(i+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}function w(t,n,r,o){function i(t,e,n){var r=this.editor.view.translateExtent,o=r[0][0],i=r[0][1],u=r[1][0],a=r[1][1];t.position[0]=Math.min(u,Math.max(o,t.position[0]+e)),t.position[1]=Math.min(a,Math.max(i,t.position[1]+n))}var u=this,a=o.changeDetector.locals.node;a.el=n,o.watch("node.style",function(){Object.assign(n.style,a.style)},{deep:!0}),e.select(n).call(e.drag().on("start",function(){e.select(n).raise(),e.event.sourceEvent.shiftKey||u.editor.selectNode(a,e.event.sourceEvent.ctrlKey)}).on("drag",function(){if(!u.editor.readOnly&&!a.readOnly){var t=u.transform.k,n=e.event.dx/t,r=e.event.dy/t;u.editor.selected.each(function(t){i.call(u,t,n,r)}),u.editor.selected.eachGroup(function(t){for(var e in t.nodes){var o=t.nodes[e];u.editor.selected.contains(o)||i.call(u,o,n,r)}}),u.update()}}).on("end",function(){u.editor.groups.forEach(function(t){u.editor.selected.eachNode(function(e){var n=t.containNode(e),r=t.isCoverNode(e);n&&!r?t.removeNode(e):!n&&r&&t.addNode(e)})}),u.editor.eventListener.trigger("change"),u.update()})),window.addEventListener("load",function(){a.width=n.offsetWidth,a.height=n.offsetHeight});var s={"Remove node":function(){u.editor.removeNode(a)},"Add to group":function(){var t=new Y("Group",{nodes:[a]});u.editor.addGroup(t)}},c=function(t){t.call(u),u.contextMenu.hide()};e.select(n).on("contextmenu",function(){if(!u.editor.readOnly&&!a.readOnly){var t=e.event.clientX,n=e.event.clientY;u.editor.selectNode(a),u.contextMenu.show(t,n,s,!1,c),e.event.preventDefault()}})}function b(t,e){e.directives.al.node=w.bind(t),e.directives.al.group=c.bind(t),e.directives.al.groupHandler=l.bind(t),e.directives.al.groupTitle=f.bind(t),e.directives.al.pickInput=h.bind(t),e.directives.al.pickOutput=d.bind(t),e.directives.al.control=m.bind(t),e.directives.al.connection=v.bind(t)}function x(t,e){e.directives.al.item=y.bind(t)}function k(t){var e="";try{var n={};e+='<div class="context-menu" :style.left="contextMenu.x+&quot;px&quot;" :style.top="contextMenu.y+&quot;px&quot;" @mouseleave="contextMenu.hide()" al-if="contextMenu.visible">',e+='<div class="search item" al-if="contextMenu.searchBar">',e+='<input al-value="filter"></div>',e+='<div class="item" al-repeat="(name,item) in contextMenu.searchItems(filter)" al-item>',e+="{{name}}",e+='<div class="subitems" al-if="contextMenu.haveSubitems(item)">',e+='<div class="item" al-repeat="(name,subitem) in item" al-item>',e+="{{name}}</div></div></div></div>"}catch(t){pug.rethrow(t,void 0,void 0,n[void 0])}return e}function E(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=E(t[0],e);return t.every(function(t){return E(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return E(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),i=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+E(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(i+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}function O(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=O(t[0],e);return t.every(function(t){return O(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return O(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),i=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+O(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(i+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}function j(t){var e="";try{var n={};e+="\x3c!-- Groups--\x3e",e+='<div class="group" al-repeat="group in editor.groups" :style.transform="&quot;translate(&quot;+group.position[0]+&quot;px,&quot;+group.position[1]+&quot;px)&quot;" :style.width="group.width+&quot;px&quot;" :style.height="group.height+&quot;px&quot;" al-group :class.selected="editor.selected.contains(group)">',e+='<div class="group-title" al-group-title>',e+="{{group.title}}</div>",e+='<div class="group-handler right bottom" al-group-handler="rb"></div>',e+='<div class="group-handler left top" al-group-handler="lt"></div>',e+='<div class="group-handler left bottom" al-group-handler="lb"></div>',e+='<div class="group-handler right top" al-group-handler="rt"></div></div>',e+="\x3c!-- Connections--\x3e",e+='<svg class="connections">',e+='<path class="connection" al-repeat="path in editor.paths" :d="path.d" al-connection :class.selected="path.selected"></path></svg>',e+="\x3c!-- Nodes--\x3e",e+="<div class=\"node {{editor.selected.contains(node)?'selected':''}} {{node.title.toLowerCase().replace(' ','-')}}\" al-repeat=\"node in editor.nodes\" :style.transform=\"&quot;translate(&quot;+node.position[0]+&quot;px,&quot;+node.position[1]+&quot;px)&quot;\" al-node :data-id=\"node.id\">",e+='<div al-html="editor.view.getTemplate(node)"></div></div>'}catch(t){pug.rethrow(t,void 0,void 0,n[void 0])}return e}function N(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=N(t[0],e);return t.every(function(t){return N(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return N(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),i=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+N(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(i+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}function T(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=T(t[0],e);return t.every(function(t){return T(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return T(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),i=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+T(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(i+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}function A(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=A(t[0],e);return t.every(function(t){return A(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return A(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),i=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+A(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(i+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}function G(t,e){if(void 0===e&&(e=0),e+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":C(t);if(Array.isArray(t)){if(t.length>0){if(e>4)return"[...]";var n=G(t[0],e);return t.every(function(t){return G(t,e)===n})?n.trim()+"[]":"["+t.slice(0,15).map(function(t){return G(t,e)}).join(", ")+(t.length>=15?", ...":"")+"]"}return"Array"}var r=Object.keys(t);if(!r.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(e>4)return"{...}";var o="  ".repeat(e-1),i=r.slice(0,15).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:JSON.stringify(n))+": "+G(t[n],e)+";"}).join("\n  "+o);return r.length>=15&&(i+="\n  "+o+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}var C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},_=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),R=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},L=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},M=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},S=function(){function t(e,n,r){V(this,t);var o=t.extractNodes(e,n),i=t.extractNodes(e,r);this.inputs=[],this.outputs=[],this.keys={input:o.map(function(t){return t.data.name}),output:i.map(function(t){return t.data.name})}}return _(t,[{key:"read",value:function(t){var e=this;this.keys.input.forEach(function(n,r){e.inputs[n]=t[r]})}},{key:"write",value:function(t){var e=this;this.keys.output.forEach(function(n,r){t[r]=e.outputs[n]})}}],[{key:"extractNodes",value:function(t,e){return Object.keys(t.nodes).filter(function(n){return e.includes(t.nodes[n].title)}).map(function(e){return t.nodes[e]}).sort(function(t,e){return t.position[1]>e.position[1]})}}]),t}(),I=function(){function t(e,n){V(this,t),this.engine=null,this.titlesInput=e,this.titlesOutput=n}return _(t,[{key:"getInputs",value:function(t){return S.extractNodes(t,this.titlesInput).map(function(t){return{title:t.title,name:t.data.name}})}},{key:"getOutputs",value:function(t){return S.extractNodes(t,this.titlesOutput).map(function(t){return{title:t.title,name:t.data.name}})}},{key:"workerModule",value:function(t,e,n){var r,o,i;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return r=t.data.module.data,o=new S(r,this.titlesInput,this.titlesOutput),i=this.engine.clone(),o.read(e),u.next=6,regeneratorRuntime.awrap(i.process(r,null,o));case 6:o.write(n);case 7:case"end":return u.stop()}},null,this)}},{key:"workerInputs",value:function(t,e,n,r){r&&(n[0]=r.inputs[t.data.name][0])}},{key:"workerOutputs",value:function(t,e,n,r){r&&(r.outputs[t.data.name]=e[0][0])}},{key:"setEngine",value:function(t){this.engine=t}}]),t}(),P=function t(e,n){V(this,t),this.name=e,this.worker=n.worker},$=function(){function t(e){if(V(this,t),this.constructor===t)throw new TypeError("Cannot construct Block instances");this.id=t.incrementId(e),this.position=[0,0],this.width=0,this.height=0,this.style={}}return _(t,null,[{key:"incrementId",value:function(t){return t.latestId?t.latestId++:t.latestId=1,t.latestId}}]),t}(),D=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(V(this,t),"string"!=typeof e)throw new TypeError('Value of argument "html" violates contract.\n\nExpected:\nstring\n\nGot:\n'+r(e));this.html=e,this.parent=null,this.handler=n}return _(t,[{key:"getNode",value:function(){if(null===this.parent)throw new Error("Control isn't added to Node/Input");return this.parent instanceof W?this.parent:this.parent.node}},{key:"getData",value:function(t){return this.getNode().data[t]}},{key:"putData",value:function(t,e){this.getNode().data[t]=e}}]),t}(),J=function(){function t(e,n){V(this,t),this.output=e,this.input=n,this.style={},this.input.addConnection(this)}return _(t,[{key:"remove",value:function(){this.input.removeConnection(this),this.output.removeConnection(this)}}]),t}(),Z=function(){function t(e,n,r){V(this,t),this.node=null,this.multipleConnections=r,this.connections=[],this.title=e,this.socket=n}return _(t,[{key:"removeConnection",value:function(t){if(!(t instanceof J))throw new TypeError('Value of argument "connection" violates contract.\n\nExpected:\nConnection\n\nGot:\n'+o(t));this.connections.splice(this.connections.indexOf(t),1)}}]),t}(),B=function(){function t(e,n,r){if(V(this,t),"string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof n)throw new TypeError('Value of argument "name" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof r)throw new TypeError('Value of argument "hint" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));this.id=e,this.name=n,this.hint=r,this.compatible=[]}return _(t,[{key:"combineWith",value:function(e){if(!(e instanceof t))throw new TypeError('Value of argument "socket" violates contract.\n\nExpected:\nSocket\n\nGot:\n'+i(e));this.compatible.push(e)}},{key:"compatibleWith",value:function(e){if(!(e instanceof t))throw new TypeError('Value of argument "socket" violates contract.\n\nExpected:\nSocket\n\nGot:\n'+i(e));return this===e||this.compatible.includes(e)}}]),t}(),H=function(t){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(V(this,e),"string"!=typeof t)throw new TypeError('Value of argument "title" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t))
;if(!(n instanceof B))throw new TypeError('Value of argument "socket" violates contract.\n\nExpected:\nSocket\n\nGot:\n'+u(n));if("boolean"!=typeof r)throw new TypeError('Value of argument "multiConns" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+u(r));var o=L(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return o.control=null,o}return R(e,t),_(e,[{key:"hasConnection",value:function(){return this.connections.length>0}},{key:"addConnection",value:function(t){if(!(t instanceof J))throw new TypeError('Value of argument "connection" violates contract.\n\nExpected:\nConnection\n\nGot:\n'+u(t));if(!this.multipleConnections&&this.hasConnection())throw new Error("Multiple connections not allowed");this.connections.push(t)}},{key:"addControl",value:function(t){if(!(t instanceof D))throw new TypeError('Value of argument "control" violates contract.\n\nExpected:\nControl\n\nGot:\n'+u(t));this.control=t,t.parent=this}},{key:"showControl",value:function(){return!this.hasConnection()&&null!==this.control}},{key:"toJSON",value:function(){return{connections:this.connections.map(function(t){return{node:t.output.node.id,output:t.output.node.outputs.indexOf(t.output)}})}}}]),e}(Z),q=function(t){function e(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(V(this,e),"string"!=typeof t)throw new TypeError('Value of argument "title" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(!(n instanceof B))throw new TypeError('Value of argument "socket" violates contract.\n\nExpected:\nSocket\n\nGot:\n'+a(n));if("boolean"!=typeof r)throw new TypeError('Value of argument "multiConns" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+a(r));return L(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r))}return R(e,t),_(e,[{key:"hasConnection",value:function(){return this.connections.length>0}},{key:"connectTo",value:function(t){if(!(t instanceof H))throw new TypeError('Value of argument "input" violates contract.\n\nExpected:\nInput\n\nGot:\n'+a(t));if(!this.socket.compatibleWith(t.socket))throw new Error("Sockets not compatible");if(!t.multipleConnections&&t.hasConnection())throw new Error("Input already has one connection");if(!this.multipleConnections&&this.hasConnection())throw new Error("Output already has one connection");var e=new J(this,t);return this.connections.push(e),e}},{key:"connectedTo",value:function(t){if(!(t instanceof H))throw new TypeError('Value of argument "input" violates contract.\n\nExpected:\nInput\n\nGot:\n'+a(t));return this.connections.some(function(e){return e.input===t})}},{key:"toJSON",value:function(){return{connections:this.connections.map(function(t){return{node:t.input.node.id,input:t.input.node.inputs.indexOf(t.input)}})}}}]),e}(Z),W=function(t){function e(t){if(V(this,e),"string"!=typeof t)throw new TypeError('Value of argument "title" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));var n=L(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,e));n.group=null,n.inputs=[],n.outputs=[],n.controls=[],n.data={},n.readOnly=!1,n.title=t;var r=[180,100];return n.width=r[0],n.height=r[1],n}return R(e,t),_(e,[{key:"addControl",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!(t instanceof D))throw new TypeError('Value of argument "control" violates contract.\n\nExpected:\nControl\n\nGot:\n'+s(t));if(!(null==e||"number"==typeof e&&!isNaN(e)&&e>=0&&e<=255&&e===Math.floor(e)))throw new TypeError('Value of argument "index" violates contract.\n\nExpected:\n?uint8\n\nGot:\n'+s(e));return t.parent=this,null!==e?this.controls.splice(e,0,t):this.controls.push(t),this}},{key:"addInput",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!(t instanceof H))throw new TypeError('Value of argument "input" violates contract.\n\nExpected:\nInput\n\nGot:\n'+s(t));if(!(null==e||"number"==typeof e&&!isNaN(e)&&e>=0&&e<=255&&e===Math.floor(e)))throw new TypeError('Value of argument "index" violates contract.\n\nExpected:\n?uint8\n\nGot:\n'+s(e));if(null!==t.node)throw new Error("Input has already been added to the node");return t.node=this,null!==e?this.inputs.splice(e,0,t):this.inputs.push(t),this}},{key:"addOutput",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!(t instanceof q))throw new TypeError('Value of argument "output" violates contract.\n\nExpected:\nOutput\n\nGot:\n'+s(t));if(!(null==e||"number"==typeof e&&!isNaN(e)&&e>=0&&e<=255&&e===Math.floor(e)))throw new TypeError('Value of argument "index" violates contract.\n\nExpected:\n?uint8\n\nGot:\n'+s(e));if(null!==t.node)throw new Error("Output has already been added to the node");return t.node=this,null!==e?this.outputs.splice(e,0,t):this.outputs.push(t),this}},{key:"getConnections",value:function(t){var e=[];return"input"!==t&&t||this.inputs.map(function(t){t.connections.forEach(function(t){e.push(t)})}),"output"!==t&&t||this.outputs.forEach(function(t){t.connections.forEach(function(t){e.push(t)})}),e}},{key:"inputsWithVisibleControl",value:function(){return this.inputs.filter(function(t){return t.showControl()})}},{key:"toJSON",value:function(){return{id:this.id,data:this.data,group:this.group?this.group.id:null,inputs:this.inputs.map(function(t){return t.toJSON()}),outputs:this.outputs.map(function(t){return t.toJSON()}),position:this.position,title:this.title}}}],[{key:"fromJSON",value:function(t,n){var r;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:if(t instanceof K){o.next=2;break}throw new TypeError('Value of argument "component" violates contract.\n\nExpected:\nComponent\n\nGot:\n'+s(t));case 2:if(n instanceof Object){o.next=4;break}throw new TypeError('Value of argument "json" violates contract.\n\nExpected:\nObject\n\nGot:\n'+s(n));case 4:return r=t.newNode(),r.id=n.id,r.data=n.data,e.latestId=Math.max(r.id,e.latestId),r.position=n.position,r.title=n.title,o.next=12,regeneratorRuntime.awrap(t.builder(r));case 12:return o.abrupt("return",r);case 13:case"end":return o.stop()}},null,this)}}]),e}($),z=function(t){var e="";try{var n={};e+='<div class="title">',e+="{{node.title}}</div>",e+="\x3c!-- Outputs--\x3e",e+='<div al-repeat="output in node.outputs" style="text-align: right">',e+='<div class="output-title">',e+="{{output.title}}</div>",e+="<div class=\"socket output {{output.socket.id.toLowerCase().replace(' ','-')}}\" al-pick-output title=\"{{output.socket.name}}\n{{output.socket.hint}}\"></div></div>",e+="\x3c!-- Controls--\x3e",e+='<div class="control" al-repeat="control in node.controls" style="text-align: center" :width="control.parent.width - 2 * control.margin" :height="control.height" al-control="control"></div>',e+="\x3c!-- Inputs--\x3e",e+='<div al-repeat="input in node.inputs" style="text-align: left">',e+="<div class=\"socket input {{input.socket.id.toLowerCase().replace(' ','-')}} {{input.multipleConnections?'multiple':''}}\" al-pick-input title=\"{{input.socket.name}}\n{{input.socket.hint}}\"></div>",e+='<div class="input-title" al-if="!input.showControl()">',e+="{{input.title}}</div>",e+='<div class="input-control" al-if="input.showControl()" al-control="input.control"></div></div>'}catch(t){pug.rethrow(t,void 0,void 0,n[void 0])}return e}(),K=function(t){function e(t,n){V(this,e);var r=L(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.template=n.template||z,r.builder=n.builder,r.created=n.created||function(){},r.destroyed=n.destroyed||function(){},r}return R(e,t),_(e,[{key:"newNode",value:function(){return new W(this.name)}}]),e}(P),F=function(){function t(){V(this,t)}return _(t,null,[{key:"nodesBBox",value:function(t){var e=function(t){return Math.min.apply(Math,M(t))},n=function(t){return Math.max.apply(Math,M(t))},r=e(t.map(function(t){return t.position[0]})),o=e(t.map(function(t){return t.position[1]})),i=n(t.map(function(t){return t.position[0]+t.width})),u=n(t.map(function(t){return t.position[1]+t.height}));return{left:r,right:i,top:o,bottom:u,width:Math.abs(r-i),height:Math.abs(o-u),getCenter:function(){return[(r+i)/2,(o+u)/2]}}}},{key:"isValidData",value:function(t){return"string"==typeof t.id&&this.isValidId(t.id)&&t.nodes instanceof Object&&!(t.nodes instanceof Array)&&(!t.groups||t.groups instanceof Object)}},{key:"isValidId",value:function(t){return/^[\w-]{3,}@[0-9]+\.[0-9]+\.[0-9]+$/.test(t)}},{key:"validate",value:function(t,e){var n="",r=t.split("@"),o=e.id.split("@");return this.isValidData(e)||(n+="Data is not suitable. "),t!==e.id&&(n+="IDs not equal. "),r[0]!==o[0]&&(n+="Names don't match. "),r[1]!==o[1]&&(n+="Versions don't match"),{success:""===n,msg:n}}}]),t}(),Y=function(t){function e(t,n){if(V(this,e),"string"!=typeof t)throw new TypeError('Value of argument "title" violates contract.\n\nExpected:\nstring\n\nGot:\n'+g(t));if(!(n instanceof Object))throw new TypeError('Value of argument "params" violates contract.\n\nExpected:\nObject\n\nGot:\n'+g(n));var r=L(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,e));return r.title=t,r.nodes=[],r.setMinSizes(300,250),n.nodes?r.coverNodes(n.nodes):(r.position=n.position,r.width=n.width,r.height=n.height),r}return R(e,t),_(e,[{key:"setMinSizes",value:function(t,e){this.minWidth=t,this.minHeight=e}},{key:"setWidth",value:function(t){if("number"!=typeof t)throw new TypeError('Value of argument "w" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+g(t));return this.width=Math.max(this.minWidth,t)}},{key:"setHeight",value:function(t){if("number"!=typeof t)throw new TypeError('Value of argument "h" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+g(t));return this.height=Math.max(this.minHeight,t)}},{key:"isCoverNode",value:function(t){if(!(t instanceof W))throw new TypeError('Value of argument "node" violates contract.\n\nExpected:\nNode\n\nGot:\n'+g(t));var e=this.position,n=t.position;return n[0]>e[0]&&n[1]>e[1]&&n[0]+t.width<e[0]+this.width&&n[1]+t.height<e[1]+this.height}},{key:"coverNodes",value:function(t){if(!Array.isArray(t)||!t.every(function(t){return t instanceof W}))throw new TypeError('Value of argument "nodes" violates contract.\n\nExpected:\nNode[]\n\nGot:\n'+g(t));var e=this,n=F.nodesBBox(t);t.forEach(function(t){t.readOnly||(null!==t.group&&t.group.removeNode(t.group),e.addNode(t))}),this.position=[n.left-30,n.top-60],this.setWidth(n.right-n.left+60),this.setHeight(n.bottom-n.top+90)}},{key:"containNode",value:function(t){if(!(t instanceof W))throw new TypeError('Value of argument "node" violates contract.\n\nExpected:\nNode\n\nGot:\n'+g(t));return-1!==this.nodes.indexOf(t)}},{key:"addNode",value:function(t){if(!(t instanceof W))throw new TypeError('Value of argument "node" violates contract.\n\nExpected:\nNode\n\nGot:\n'+g(t));return!this.containNode(t)&&(null!==t.group&&t.group.removeNode(t),t.group=this,this.nodes.push(t),!0)}},{key:"removeNode",value:function(t){if(!(t instanceof W))throw new TypeError('Value of argument "node" violates contract.\n\nExpected:\nNode\n\nGot:\n'+g(t));this.containNode(t)&&(this.nodes.splice(this.nodes.indexOf(t),1),t.group=null)}},{key:"remove",value:function(){this.nodes.forEach(function(t){t.group=null})}},{key:"toJSON",value:function(){return{id:this.id,title:this.title,nodes:this.nodes.map(function(t){return t.id}),minWidth:this.minWidth,minHeight:this.minHeight,position:this.position,width:this.width,height:this.height}}}],[{key:"fromJSON",value:function(t){if(!(t instanceof Object))throw new TypeError('Value of argument "json" violates contract.\n\nExpected:\nObject\n\nGot:\n'+g(t));var n=new e(t.title,{position:t.position,width:t.width,height:t.height});return n.id=t.id,e.latestId=Math.max(n.id,e.latestId),n.minWidth=t.minWidth,n.minHeight=t.minHeight,n}}]),e}($),U=function(){function t(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(V(this,t),!(e instanceof Object))throw new TypeError('Value of argument "items" violates contract.\n\nExpected:\nObject\n\nGot:\n'+E(e));if("boolean"!=typeof n)throw new TypeError('Value of argument "searchBar" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+E(n));this.visible=!1,this.disabled=r,this.x=0,this.y=0,this.default={items:e,searchBar:n,onClick:function(){throw new TypeError("onClick should be overrided")}},this.bindTemplate(k())}return _(t,[{key:"bindTemplate",value:function(t){this.dom=e.select("body").append("div"),this.dom.node().setAttribute("tabindex",1),this.dom.html(t);var r=n.makeInstance();x(this,r),this.$cd=r(this.dom.node(),{contextMenu:this})}},{key:"searchItems",value:function(t){var e=this;if(null!=t&&"string"!=typeof t)throw new TypeError('Value of argument "filter" violates contract.\n\nExpected:\n?string\n\nGot:\n'+E(t));var n=new RegExp(t,"i"),r={};return Object.keys(this.items).forEach(function(t){var o=e.items[t];if(o.constructor===Object){var i=Object.keys(o).filter(function(t){return n.test(t)});i.length>0&&(r[t]={},i.forEach(function(e){r[t][e]=o[e]}))}n.test(t)&&(r[t]=o)}),r}},{key:"haveSubitems",value:function(t){return t.constructor===Object}},{key:"isVisible",value:function(){return this.visible}},{key:"show",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if("number"!=typeof t)throw new TypeError('Value of argument "x" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+E(t));if("number"!=typeof e)throw new TypeError('Value of argument "y" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+E(e));if(!(null==n||n instanceof Object))throw new TypeError('Value of argument "items" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+E(n));if(null!=r&&"boolean"!=typeof r)throw new TypeError('Value of argument "searchBar" violates contract.\n\nExpected:\n?boolean\n\nGot:\n'+E(r));this.disabled||(this.visible=!0,this.items=n||this.default.items,this.searchBar=r||this.default.searchBar,this.onClick=o||this.default.onClick,this.x=t,this.y=e,this.$cd.scan())}},{key:"hide",value:function(){this.visible=!1,this.$cd.scan()}}]),t}(),X=function(t){return parseInt(t)},Q=function(t,e){return t.every(function(t,n){return t===e[n]})},tt=function(t,e){return JSON.stringify(t)===JSON.stringify(e)},et=function(t,e,n){return t.node===e.node&&t[n]===e[n]},nt=function(t,e){return{removed:t.filter(function(t){return!e.some(function(e){return et(t,e,"input")})}),added:e.filter(function(e){return!t.some(function(t){return et(t,e,"input")})})}},rt=function(){function t(e,n){V(this,t),this.a=e,this.b=n}return _(t,[{key:"basicDiffs",value:function(){var t=Object.keys(this.a.nodes),e=Object.keys(this.b.nodes);return{removed:t.filter(function(t){return!e.includes(t)}).map(X),added:e.filter(function(e){return!t.includes(e)}).map(X),stayed:t.filter(function(t){return e.includes(t)}).map(X)}}},{key:"compare",value:function(){var t=this,e=this.basicDiffs(),n=e.removed,r=e.added,o=e.stayed;return{removed:n,added:r,moved:o.filter(function(e){var n=t.a.nodes[e].position,r=t.b.nodes[e].position;return!Q(n,r)}),datachanged:o.filter(function(e){var n=t.a.nodes[e].data,r=t.b.nodes[e].data;return!tt(n,r)}),connects:o.reduce(function(e,n){var r=t.a.nodes[n].outputs,o=t.b.nodes[n].outputs,i=r.map(function(t,e){return Object.assign({output:e},nt(t.connections,o[e].connections))}).filter(function(t){return 0!==t.added.length||0!==t.removed.length});return[].concat(M(e),M(i.map(function(t){return t.node=n,t})))},[])}}}]),t}(),ot={AVALIABLE:0,PROCESSED:1,ABORT:2},it=function(){function t(e,n){if(V(this,t),"string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+O(e));if(!Array.isArray(n)||!n.every(function(t){return t instanceof P}))throw new TypeError('Value of argument "components" violates contract.\n\nExpected:\nComponentWorker[]\n\nGot:\n'+O(n));if(!F.isValidId(e))throw new Error("ID should be valid to name@0.1.0 format");this.id=e,this.components=n,this.args=[],this.data=null,this.state=ot.AVALIABLE,this.onAbort=function(){},this.onError=function(t,e){console.error(t,e)}}return _(t,[{key:"clone",value:function(){return new t(this.id,this.components)}},{key:"throwError",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(this.abort());case 2:return this.onError(t,e),this.processDone(),n.abrupt("return","error");case 5:case"end":return n.stop()}},null,this)}},{key:"extractInputNodes",value:function(t,e){return t.inputs.reduce(function(t,n){return[].concat(M(t),M((n.connections||[]).reduce(function(t,n){return[].concat(M(t),[e[n.node]])},[])))},[])}},{key:"detectRecursions",value:function(t){var e=this,n=function n(r,o){if(o.some(function(t){return t===r}))return r;for(var i=0;i<o.length;i++)if(n(r,e.extractInputNodes(o[i],t)))return r;return null};return Object.keys(t).map(function(e){return t[e]}).map(function(r){return n(r,e.extractInputNodes(r,t))}).filter(function(t){return null!==t})}},{key:"processStart",value:function(){return this.state===ot.AVALIABLE?(this.state=ot.PROCESSED,!0):this.state!==ot.ABORT&&(console.warn("The process is busy and has not been restarted.\n                Use abort() to force it to complete"),!1)}},{key:"processDone",value:function(){var t=this.state!==ot.ABORT;return this.state=ot.AVALIABLE,t||(this.onAbort(),this.onAbort=function(){}),t}},{key:"abort",value:function(){var t=this;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){t.state===ot.PROCESSED?(t.state=ot.ABORT,t.onAbort=e):t.state===ot.ABORT?(t.onAbort(),t.onAbort=e):e()}));case 1:case"end":return e.stop()}},null,this)}},{key:"lock",value:function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){t.unlockPool=t.unlockPool||[],t.busy&&!t.outputData?t.unlockPool.push(e):e(),t.busy=!0}));case 1:case"end":return e.stop()}},null,this)}},{key:"unlock",value:function(t){t.unlockPool.forEach(function(t){return t()}),t.unlockPool=[],t.busy=!1}},{key:"extractInputData",value:function(t){var e=this;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(Promise.all(t.inputs.map(function(t){var n,r;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return n=t.connections,o.next=3,regeneratorRuntime.awrap(Promise.all(n.map(function(t){var n,r;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return n=e.data.nodes[t.node],o.next=3,regeneratorRuntime.awrap(e.processNode(n));case 3:if(r=o.sent){o.next=8;break}e.abort(),o.next=9;break;case 8:return o.abrupt("return",r[t.output]);case 9:case"end":return o.stop()}},null,e)})));case 3:return r=o.sent,o.abrupt("return",r);case 5:case"end":return o.stop()}},null,e)})));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},null,this)}},{key:"processWorker",value:function(t){var e,n,r;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,regeneratorRuntime.awrap(this.extractInputData(t));case 2:return e=o.sent,n=this.components.find(function(e){return e.name===t.title}),r=t.outputs.map(function(){return null}),o.prev=5,o.next=8,regeneratorRuntime.awrap(n.worker.apply(n,[t,e,r].concat(M(this.args))));case 8:o.next=14;break;case 10:o.prev=10,o.t0=o.catch(5),this.abort(),console.warn(o.t0);case 14:return o.abrupt("return",r);case 15:case"end":return o.stop()}},null,this,[[5,10]])}},{key:"processNode",value:function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state!==ot.ABORT&&t){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,regeneratorRuntime.awrap(this.lock(t));case 4:return t.outputData||(t.outputData=this.processWorker(t)),this.unlock(t),e.abrupt("return",t.outputData);case 7:case"end":return e.stop()}},null,this)}},{key:"forwardProcess",value:function(t){var e=this;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.state!==ot.ABORT){n.next=2;break}return n.abrupt("return",null);case 2:return n.next=4,regeneratorRuntime.awrap(Promise.all(t.outputs.map(function(t){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(Promise.all(t.connections.map(function(t){var n;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.data.nodes[t.node],r.next=3,regeneratorRuntime.awrap(e.processNode(n));case 3:return r.next=5,regeneratorRuntime.awrap(e.forwardProcess(n));case 5:case"end":return r.stop()}},null,e)})));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},null,e)})));case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},null,this)}},{key:"copy",value:function(t){return t=Object.assign({},t),t.nodes=Object.assign({},t.nodes),Object.keys(t.nodes).forEach(function(e){t.nodes[e]=Object.assign({},t.nodes[e])}),t}},{key:"validate",value:function(t){var e,n;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(e=F.validate(this.id,t),e.success){r.next=5;break}return r.next=4,regeneratorRuntime.awrap(this.throwError(e.msg));case 4:return r.abrupt("return",r.sent);case 5:if(n=this.detectRecursions(t.nodes),!(n.length>0)){r.next=10;break}return r.next=9,regeneratorRuntime.awrap(this.throwError("Recursion detected",n));case 9:return r.abrupt("return",r.sent);case 10:return r.abrupt("return",!0);case 11:case"end":return r.stop()}},null,this)}},{key:"processStartNode",value:function(t){var e;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=10;break}if(e=this.data.nodes[t]){n.next=6;break}return n.next=5,regeneratorRuntime.awrap(this.throwError("Node with such id not found"));case 5:return n.abrupt("return",n.sent);case 6:return n.next=8,regeneratorRuntime.awrap(this.processNode(e));case 8:return n.next=10,regeneratorRuntime.awrap(this.forwardProcess(e));case 10:case"end":return n.stop()}},null,this)}},{key:"processUnreachable",value:function(){var t,e;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=regeneratorRuntime.keys(this.data.nodes);case 1:if((n.t1=n.t0()).done){n.next=11;break}if(t=n.t1.value,void 0!==this.data.nodes[t].outputData){n.next=9;break}return e=this.data.nodes[t],n.next=7,regeneratorRuntime.awrap(this.processNode(e));case 7:return n.next=9,regeneratorRuntime.awrap(this.forwardProcess(e));case 9:n.next=1;break;case 11:case"end":return n.stop()}},null,this)}},{key:"process",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(t instanceof Object){n.next=2;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+O(t));case 2:if(null==e||"number"==typeof e){n.next=4;break}throw new TypeError('Value of argument "startId" violates contract.\n\nExpected:\n?number\n\nGot:\n'+O(e));case 4:if(this.processStart()){n.next=6;break}return n.abrupt("return");case 6:if(this.validate(t)){n.next=8;break}return n.abrupt("return");case 8:return this.data=this.copy(t),this.args=r,n.next=12,regeneratorRuntime.awrap(this.processStartNode(e));case 12:return n.next=14,regeneratorRuntime.awrap(this.processUnreachable());case 14:return n.abrupt("return",this.processDone()?"success":"aborted");case 15:case"end":return n.stop()}},null,this)}}]),t}(),ut=function(){function t(){V(this,t)}return _(t,null,[{key:"getInputPosition",value:function(t){var e=t.node,n=t.el;return[e.position[0]+n.offsetLeft+n.offsetWidth/2,e.position[1]+n.offsetTop+n.offsetHeight/2]}},{key:"getOutputPosition",value:function(t){var e=t.node,n=t.el;return[e.position[0]+n.offsetLeft+n.offsetWidth/2,e.position[1]+n.offsetTop+n.offsetHeight/2]}},{key:"getConnectionPath",value:function(t,n,r,o){var i=r.apply(void 0,M(t).concat(M(n),[o])),u=i.points,a=i.curve;switch(a){case"linear":a=e.curveLinear;break;case"step":a=e.curveStep;break;case"basis":default:a=e.curveBasis}return this.pointsToPath(u,a)}},{key:"pointsToPath",value:function(t,n){var r=n(e.path());r.lineStart();for(var o=0;o<t.length;o++)r.point.apply(r,M(t[o]));return r.lineEnd(),r._context.toString()}}]),t}(),at=function t(e,n){V(this,t),this.connection=null,this.input=n,this.output=e},st=function(){function t(n,r,o){if(V(this,t),!(n instanceof dt))throw new TypeError('Value of argument "editor" violates contract.\n\nExpected:\nNodeEditor\n\nGot:\n'+N(n));if(!(r instanceof HTMLElement))throw new TypeError('Value of argument "container" violates contract.\n\nExpected:\nHTMLElement\n\nGot:\n'+N(r));if(!(null==o||o instanceof U))throw new TypeError('Value of argument "menu" violates contract.\n\nExpected:\n?ContextMenu\n\nGot:\n'+N(o));this.editor=n,this.pickedOutput=null,this.container=e.select(r).attr("tabindex",1),this.mouse=[0,0],this.transform=e.zoomIdentity,this.contextMenu=o||new U({},!0,!0),this.initView(),this.initial()}return _(t,[{key:"initial",value:function(){this.setScaleExtent(.1,1);var t=Math.pow(2,12);this.setTranslateExtent(-t,-t,t,t)}},{key:"initView",value:function(){var t=this;this.container.on("click",function(){t.container.node()===e.event.target&&t.areaClick()}),this.view=this.container.append("div").style("transform-origin","0 0").style("width",1).style("height",1),this.zoom=e.zoom().on("zoom",function(){t.transform=e.event.transform,t.update(),t.editor.eventListener.trigger("transform",t.transform)}),this.container.call(this.zoom),e.select(window).on("mousemove.d3ne"+this.editor._id,function(){var n=t.transform.k,r=e.mouse(t.view.node());t.mouse=[r[0]/n,r[1]/n],t.update()}).on("keydown.d3ne"+this.editor._id,function(e){t.container.node()===document.activeElement&&t.editor.keyDown(e)}).on("resize.d3ne"+this.editor._id,this.resize.bind(this)),this.view.html(j()),this.initAlight()}},{key:"initAlight",value:function(){var t=n.makeInstance();b(this,t),this.$cd=t(this.view.node(),{editor:this.editor})}},{key:"getTemplate",value:function(t){var e=this.editor.components.find(function(e){return e.name===t.title});if(!e)throw new Error('Component not found. Make sure you have defined \n                            the component with the "'+t.title+'" name');return e.template}},{key:"resize",value:function(){var t=this.container.node().parentElement.clientWidth,e=this.container.node().parentElement.clientHeight;this.container.style("width",t+"px").style("height",e+"px"),this.update()}},{key:"connectionProducer",value:function(t,e,n,r){var o=.3*Math.abs(t-n),i=.1*(r-e);return{points:[[t,e],[t+o,e+i],[n-o,r-i],[n,r]],curve:"basis"}}},{key:"updateConnections",value:function(){var t=this,e=[];if(this.editor.nodes.forEach(function(n){n.getConnections("output").forEach(function(n){var r=n.output,o=n.input;if(o.el){var i=new at(r,o);i.connection=n,e.push({connection:n,d:ut.getConnectionPath(ut.getOutputPosition(r),ut.getInputPosition(o),t.connectionProducer,i)})}})}),null!==this.pickedOutput&&this.pickedOutput.el){var n=this.pickedOutput,r=this.mouse,o=new at(n,r);e.push({selected:!0,d:ut.getConnectionPath(ut.getOutputPosition(n),r,this.connectionProducer,o)})}this.editor.paths=e}},{key:"update",value:function(){var t=this.transform;this.view.style("transform","translate("+t.x+"px, "+t.y+"px) scale("+t.k+")"),this.updateConnections(),this.$cd.scan()}},{key:"assignContextMenuHandler",value:function(){var t=this;this.contextMenu.default.onClick=function(e){var n;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(e instanceof K)){r.next=8;break}return n=e.newNode(),r.next=4,regeneratorRuntime.awrap(e.builder(n));case 4:t.editor.addNode(n,!0),t.editor.selectNode(n),r.next=9;break;case 8:e();case 9:t.contextMenu.hide();case 10:case"end":return r.stop()}},null,t)}}},{key:"areaClick",value:function(){this.editor.readOnly||(null===this.pickedOutput||e.event.ctrlKey?this.contextMenu.visible?this.contextMenu.hide():(this.assignContextMenuHandler(),this.contextMenu.show(e.event.pageX,e.event.pageY)):this.pickedOutput=null,this.update())}},{key:"zoomAt",value:function(t){if(!Array.isArray(t)||!t.every(function(t){return t instanceof W}))throw new TypeError('Value of argument "nodes" violates contract.\n\nExpected:\nNode[]\n\nGot:\n'+N(t));if(0!==t.length){var e=[this.container.node().clientWidth,this.container.node().clientHeight],n=e[0],r=e[1],o=F.nodesBBox(t),i=n/o.width,u=r/o.height,a=.9*Math.min(u,i,1),s=o.getCenter();this.translate(n/2-s[0]*a,r/2-s[1]*a),this.scale(a)}}},{key:"translate",value:function(t,e){this.transform.x=t,this.transform.y=e,this.update()}},{key:"scale",value:function(t){this.transform.k=t,this.update()}},{key:"setScaleExtent",value:function(t,e){if("number"!=typeof t)throw new TypeError('Value of argument "scaleMin" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+N(t));if("number"!=typeof e)throw new TypeError('Value of argument "scaleMax" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+N(e));this.scaleExtent=[t,e],this.zoom.scaleExtent(this.scaleExtent)}},{key:"setTranslateExtent",value:function(t,e,n,r){if("number"!=typeof t)throw new TypeError('Value of argument "left" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+N(t));if("number"!=typeof e)throw new TypeError('Value of argument "top" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+N(e));if("number"!=typeof n)throw new TypeError('Value of argument "right" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+N(n));if("number"!=typeof r)throw new TypeError('Value of argument "bottom" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+N(r));this.translateExtent=[[t,e],[n,r]],this.zoom.translateExtent(this.translateExtent)}},{key:"destroy",value:function(){e.select(window).on("mousemove.d3ne"+this.editor._id,null).on("keydown.d3ne"+this.editor._id,null).on("resize.d3ne"+this.editor._id,null)}}]),t}(),ct=function(){function t(){V(this,t),this.events={nodecreate:[],groupcreate:[],connectioncreate:[],noderemove:[],groupremove:[],connectionremove:[],nodeselect:[],groupselect:[],error:[console.warn],change:[],transform:[]},this.persistent=!0}return _(t,[{key:"on",value:function(t,e){var n=this;if("string"!=typeof t)throw new TypeError('Value of argument "names" violates contract.\n\nExpected:\nstring\n\nGot:\n'+T(t));if("function"!=typeof e)throw new TypeError('Value of argument "handler" violates contract.\n\nExpected:\n() => {}\n\nGot:\n'+T(e));return t.split(" ").forEach(function(t){if(!n.events[t])throw new Error("The event "+t+" does not exist");n.events[t].push(e)}),this}},{key:"trigger",value:function(t,e){var n=this;if("string"!=typeof t)throw new TypeError('Value of argument "name" violates contract.\n\nExpected:\nstring\n\nGot:\n'+T(t));if(!(t in this.events))throw new Error("The event "+t+" cannot be triggered");return this.events[t].reduce(function(t,r){return!1!==r(e,n.persistent)&&t},!0)}}]),t}(),lt=function t(e,n,r){V(this,t),this.exec=function(){e.apply(void 0,M(r))},this.undo=function(){n.apply(void 0,M(r))},this.a=r[0]},ft=function(){function t(e){V(this,t),this.editor=e,this.list=[],this._locked=!1,this.position=-1}return _(t,[{key:"add",value:function(t,e,n){this._locked||(this.position++,this.list.splice(this.position),this.list.push(new lt(t,e,n)))}},{key:"undo",value:function(){this.position<0||(this._locked=!0,this.list[this.position--].undo(),this._locked=!1)}},{key:"redo",value:function(){this.position+1>=this.list.length||(this._locked=!0,this.list[++this.position].exec(),this._locked=!1)}}]),t}(),ht=function(){function t(){V(this,t),this.list=[]}return _(t,[{key:"add",value:function(t){
var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(t instanceof W||t instanceof Y))throw new TypeError('Value of argument "item" violates contract.\n\nExpected:\nNode | Group\n\nGot:\n'+A(t));e?this.contains(t)?this.remove(t):this.list.push(t):this.list=[t]}},{key:"clear",value:function(){var t=this;this.each(function(e){t.remove(e)})}},{key:"remove",value:function(t){this.list.splice(this.list.indexOf(t),1)}},{key:"contains",value:function(t){return-1!==this.list.indexOf(t)}},{key:"each",value:function(t){this.list.forEach(t)}},{key:"eachNode",value:function(t){this.list.filter(function(t){return t instanceof W}).forEach(t)}},{key:"eachGroup",value:function(t){this.list.filter(function(t){return t instanceof Y}).forEach(t)}},{key:"getNodes",value:function(){return this.list.filter(function(t){return t instanceof W})}},{key:"getGroups",value:function(){return this.list.filter(function(t){return t instanceof Y})}}]),t}(),dt=function(){function t(e,n,r,o){if(V(this,t),"string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(e));if(!(n instanceof HTMLElement))throw new TypeError('Value of argument "container" violates contract.\n\nExpected:\nHTMLElement\n\nGot:\n'+G(n));if(!Array.isArray(r)||!r.every(function(t){return t instanceof K}))throw new TypeError('Value of argument "components" violates contract.\n\nExpected:\nComponent[]\n\nGot:\n'+G(r));if(!(null==o||o instanceof U))throw new TypeError('Value of argument "menu" violates contract.\n\nExpected:\n?ContextMenu\n\nGot:\n'+G(o));if(!F.isValidId(e))throw new Error("ID should be valid to name@0.1.0 format");this.id=e,this.components=r,this.init(),this.view=new st(this,n,o),this.view.resize()}return _(t,[{key:"init",value:function(){this._id=Math.random().toString(36).substr(2,9),this.eventListener=new ct,this.selected=new ht,this.history=new ft(this),this.nodes=[],this.groups=[],this.readOnly=!1}},{key:"addNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(t instanceof W))throw new TypeError('Value of argument "node" violates contract.\n\nExpected:\nNode\n\nGot:\n'+G(t));this.eventListener.trigger("nodecreate",t)&&(e&&(t.position=this.view.mouse),this.nodes.push(t),this.findComponent(t).created(t),this.eventListener.trigger("change"),this.history.add(this.addNode.bind(this),this.removeNode.bind(this),[t]))}},{key:"addGroup",value:function(t){if(!(t instanceof Y))throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nGroup\n\nGot:\n'+G(t));this.eventListener.trigger("groupcreate",t)&&(this.groups.push(t),this.eventListener.trigger("change")),this.view.update()}},{key:"removeNode",value:function(t){var e=this;if(!(t instanceof W))throw new TypeError('Value of argument "node" violates contract.\n\nExpected:\nNode\n\nGot:\n'+G(t));if(!t.readOnly){var n=this.nodes.indexOf(t);this.eventListener.trigger("noderemove",t)&&(t.getConnections().forEach(function(t){return e.removeConnection(t)}),this.nodes.splice(n,1),this.findComponent(t).destroyed(t),this.eventListener.trigger("change"),this.history.add(this.removeNode.bind(this),this.addNode.bind(this),[t])),this.view.update()}}},{key:"removeGroup",value:function(t){if(!(t instanceof Y))throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nGroup\n\nGot:\n'+G(t));this.eventListener.trigger("groupremove",t)&&(t.remove(),this.groups.splice(this.groups.indexOf(t),1),this.eventListener.trigger("change")),this.view.update()}},{key:"connect",value:function(t,e){if(!(t instanceof q||t instanceof J))throw new TypeError('Value of argument "output" violates contract.\n\nExpected:\nOutput | Connection\n\nGot:\n'+G(t));if(!(null==e||e instanceof H))throw new TypeError('Value of argument "input" violates contract.\n\nExpected:\n?Input\n\nGot:\n'+G(e));if(t instanceof J&&(e=t.input,t=t.output),this.eventListener.trigger("connectioncreate",{output:t,input:e}))try{var n=t.connectTo(e);this.eventListener.trigger("change"),this.history.add(this.connect.bind(this),this.removeConnection.bind(this),[n])}catch(t){this.eventListener.trigger("error",t)}this.view.update()}},{key:"removeConnection",value:function(t){if(!(t instanceof J))throw new TypeError('Value of argument "connection" violates contract.\n\nExpected:\nConnection\n\nGot:\n'+G(t));this.eventListener.trigger("connectionremove",t)&&(t.remove(),this.eventListener.trigger("change"),this.history.add(this.removeConnection.bind(this),this.connect.bind(this),[t])),this.view.update()}},{key:"selectNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(t instanceof W))throw new TypeError('Value of argument "node" violates contract.\n\nExpected:\nNode\n\nGot:\n'+G(t));if("boolean"!=typeof e)throw new TypeError('Value of argument "accumulate" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+G(e));if(-1===this.nodes.indexOf(t))throw new Error("Node not exist in list");this.eventListener.trigger("nodeselect",t)&&this.selected.add(t,e),this.view.update()}},{key:"selectGroup",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(t instanceof Y))throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nGroup\n\nGot:\n'+G(t));if("boolean"!=typeof e)throw new TypeError('Value of argument "accumulate" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+G(e));if(-1===this.groups.indexOf(t))throw new Error("Group not exist in list");this.eventListener.trigger("groupselect",t)&&this.selected.add(t,e),this.view.update()}},{key:"keyDown",value:function(){if(!this.readOnly)switch(e.event.keyCode){case 46:this.selected.eachNode(this.removeNode.bind(this)),this.selected.eachGroup(this.removeGroup.bind(this)),this.view.update();break;case 71:var t=this.selected.getNodes();t.length>0&&this.addGroup(new Y("Group",{nodes:t}));break;case 90:e.event.ctrlKey&&e.event.shiftKey?this.history.redo():e.event.ctrlKey&&this.history.undo()}}},{key:"findComponent",value:function(t){var e=this.components.find(function(e){return e.name===t.title});if(!e)throw"Component "+t.title+" was not found";return e}},{key:"clear",value:function(){this.nodes.splice(0,this.nodes.length),this.groups.splice(0,this.groups.length)}},{key:"toJSON",value:function(){var t={},e={};return this.nodes.forEach(function(e){return t[e.id]=e.toJSON()}),this.groups.forEach(function(t){return e[t.id]=t.toJSON()}),{id:this.id,nodes:t,groups:e}}},{key:"beforeImport",value:function(t){if(!(t instanceof Object))throw new TypeError('Value of argument "json" violates contract.\n\nExpected:\nObject\n\nGot:\n'+G(t));var e=F.validate(this.id,t);return e.success?(this.eventListener.persistent=!1,this.clear(),!0):(this.eventListener.trigger("error",e.msg),!1)}},{key:"afterImport",value:function(){return this.view.update(),this.eventListener.persistent=!0,!0}},{key:"fromJSON",value:function(t){var e,n=this;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(t instanceof Object){r.next=2;break}throw new TypeError('Value of argument "json" violates contract.\n\nExpected:\nObject\n\nGot:\n'+G(t));case 2:if(this.beforeImport(t)){r.next=4;break}return r.abrupt("return",!1);case 4:return e={},r.prev=5,r.next=8,regeneratorRuntime.awrap(Promise.all(Object.keys(t.nodes).map(function(r){var o,i;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return o=t.nodes[r],i=n.findComponent(o),u.next=4,regeneratorRuntime.awrap(W.fromJSON(i,o));case 4:e[r]=u.sent,n.addNode(e[r]);case 6:case"end":return u.stop()}},null,n)})));case 8:Object.keys(t.nodes).forEach(function(r){var o=t.nodes[r],i=e[r];o.outputs.forEach(function(t,r){t.connections.forEach(function(t){var o=t.node,u=t.input,a=e[o].inputs[u];n.connect(i.outputs[r],a)})})}),"object"===C(t.groups)&&Object.keys(t.groups).forEach(function(r){var o=Y.fromJSON(t.groups[r]);t.groups[r].nodes.forEach(function(t){var n=e[t];o.addNode(n)}),n.addGroup(o)}),r.next=16;break;case 12:return r.prev=12,r.t0=r.catch(5),this.eventListener.trigger("error",r.t0),r.abrupt("return",!1);case 16:return r.abrupt("return",this.afterImport());case 17:case"end":return r.stop()}},null,this,[[5,12]])}}]),t}(),pt=function(){function t(e,n){var r=this;V(this,t),this.inputs=e,this.action=n,this.next=[],this.outputData=null,this.closed=[],this.getOptions().forEach(function(t){t.forEach(function(t){t.task.next.push({index:t.index,task:r})})})}return _(t,[{key:"getOptions",value:function(){return this.inputs.filter(function(t){return t[0]&&t[0].task})}},{key:"getOutputs",value:function(){return this.inputs.filter(function(t){return t[0]&&t[0].get})}},{key:"reset",value:function(){this.outputData=null}},{key:"run",value:function(t){var e,n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return regeneratorRuntime.async(function(i){for(;;)switch(i.prev=i.next){case 0:return o.push(this),i.next=3,regeneratorRuntime.awrap(Promise.all(this.getOutputs().map(function(e){return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(Promise.all(e.map(function(e){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(!e){n.next=4;break}return n.next=3,regeneratorRuntime.awrap(e.run(t,!1,o));case 3:return n.abrupt("return",e.get());case 4:case"end":return n.stop()}},null,n)})));case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},null,n)})));case 3:if(e=i.sent,this.outputData){i.next=10;break}return i.next=7,regeneratorRuntime.awrap(this.action(e,t));case 7:return this.outputData=i.sent,i.next=10,regeneratorRuntime.awrap(Promise.all(this.next.filter(function(t){return!n.closed.includes(t.index)}).map(function(e){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(e.task.run(t,!1,o));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},null,n)})));case 10:r&&o.map(function(t){return t.reset()});case 11:case"end":return i.stop()}},null,this)}},{key:"option",value:function(t){return{task:this,index:t}}},{key:"output",value:function(t){var e=this;return{run:e.run.bind(e),get:function(){return e.outputData[t]}}}}]),t}();t.Component=K,t.ContextMenu=U,t.Control=D,t.Diff=rt,t.NodeEditor=dt,t.Engine=it,t.Group=Y,t.Input=H,t.Node=W,t.Output=q,t.Socket=B,t.Task=pt,t.Module=S,t.ModuleManager=I,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=d3-node-editor.min.js.map