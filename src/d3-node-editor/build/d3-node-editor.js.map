{"version":3,"file":"d3-node-editor.js","sources":["../src/extras/module.js","../src/component-worker.js","../src/block.js","../src/control.js","../src/connection.js","../src/io.js","../src/socket.js","../src/input.js","../src/output.js","../src/node.js","../src/templates/node.pug","../src/component.js","../src/directives/group.js","../src/directives/io.js","../src/directives/connection.js","../src/directives/control.js","../src/directives/contextmenu.js","../src/utils/common.js","../src/group.js","../src/directives/node.js","../src/directives/index.js","../src/templates/menu.pug","../src/contextmenu.js","../src/extras/diff.js","../src/engine.js","../src/utils/view.js","../src/templates/view.pug","../src/editorview.js","../src/eventlistener.js","../src/history.js","../src/selected.js","../src/editor.js","../src/extras/task.js"],"sourcesContent":["export class Module {\n    \n    constructor(data, titlesInput, titlesOutput) {\n        var inputs = Module.extractNodes(data, titlesInput);\n        var outputs = Module.extractNodes(data, titlesOutput);\n    \n        this.inputs = [];\n        this.outputs = [];\n        this.keys = {\n            input: inputs.map(n => n.data.name),\n            output: outputs.map(n => n.data.name)\n        };\n    }\n    \n    static extractNodes(data, titles) {\n        return Object.keys(data.nodes)\n            .filter(k => titles.includes(data.nodes[k].title))\n            .map(k => data.nodes[k])\n            .sort((n1, n2) => n1.position[1] > n2.position[1]);\n    }\n    \n    read(inputs) {\n        this.keys.input.forEach((key, i) => {\n            this.inputs[key] = inputs[i];\n        });\n    }\n    \n    write(outputs) {\n        this.keys.output.forEach((k, i) => {\n            outputs[i] = this.outputs[k];\n        });\n    }\n}\n    \nexport class ModuleManager {\n    constructor(titlesInput, titlesOutput) {\n        this.engine = null;\n        this.titlesInput = titlesInput;\n        this.titlesOutput = titlesOutput;\n    }\n    \n    getInputs(data) {\n        return Module.extractNodes(data, this.titlesInput)\n            .map(n => ({ title: n.title, name: n.data.name }));\n    }\n    \n    getOutputs(data) {\n        return Module\n            .extractNodes(data, this.titlesOutput)\n            .map(n => {\n                return {title: n.title, name: n.data.name};\n            });\n    }\n    \n    async workerModule(node, inputs, outputs) {\n        var data = node.data.module.data;\n        var m = new Module(data, this.titlesInput, this.titlesOutput);\n        var engine = this.engine.clone();\n            \n        m.read(inputs);\n        await engine.process(data, null, m);\n        m.write(outputs);\n    }\n    \n    workerInputs(node, inputs, outputs, module) {\n        if (module) \n            outputs[0] = module.inputs[node.data.name][0];\n    }\n        \n    workerOutputs(node, inputs, outputs, module) {\n        if (module) \n            module.outputs[node.data.name] = inputs[0][0];\n    }\n        \n    setEngine(engine) {\n        this.engine = engine;\n    }\n}","export class ComponentWorker {\n    constructor(name, props) {\n        this.name = name;\n        this.worker = props.worker;\n    }\n}","export class Block {\n\n    constructor(Class) {\n        if (this.constructor === Block)\n            throw new TypeError('Cannot construct Block instances')\n        \n        this.id = Block.incrementId(Class);\n        this.position = [0.0, 0.0];\n        this.width = 0;\n        this.height = 0;\n        this.style = {};\n    }\n\n    static incrementId(Class) {\n        if (!Class.latestId)\n            Class.latestId = 1\n        else\n            Class.latestId++\n        return Class.latestId\n    }\n}","import { Node } from './node';\n\nexport class Control {\n\n    constructor(html: string, handler = () => { }) {\n        this.html = html;\n        this.parent = null;\n        this.handler = handler;\n    }\n\n    getNode() {\n        if (this.parent === null)\n            throw new Error(\"Control isn't added to Node/Input\");   \n        \n        return this.parent instanceof Node ? this.parent : this.parent.node;\n    }\n\n    getData(key) {\n        return this.getNode().data[key];\n    }\n\n    putData(key, data) {\n        this.getNode().data[key] = data;\n    }  \n}","export class Connection {\n\n    constructor(output, input) {\n        this.output = output;\n        this.input = input;\n        this.style = {};\n\n        this.input.addConnection(this);\n    }\n\n    remove() {\n        this.input.removeConnection(this);\n        this.output.removeConnection(this);\n    }\n}","import { Connection } from './connection';\n\nexport class IO {\n\n    constructor(title, socket, multiConns) {\n\t    this.node = null;\n        this.multipleConnections = multiConns;\n        this.connections = [];\n\t   \n        this.title = title;\n        this.socket = socket;\n    }\n    \n    removeConnection(connection: Connection) {\n        this.connections.splice(this.connections.indexOf(connection), 1);\n    }\n}","export class Socket {\n\n    constructor(id: string, name: string, hint: string) {\n        this.id = id;\n        this.name = name;\n        this.hint = hint;\n        this.compatible = [];\n    }\n\n    combineWith(socket: Socket) {\n        this.compatible.push(socket);\n    }\n\n    compatibleWith(socket: Socket) {\n        return this === socket || this.compatible.includes(socket);\n    }\n}","import { Connection } from './connection';\nimport { Control } from './control';\nimport { IO } from './io';\nimport { Socket } from './socket';\n\nexport class Input extends IO {\n   \n    constructor(title: string, socket: Socket, multiConns: boolean = false) {\n        super(title, socket, multiConns);\n        this.control = null;\n    }\n\n    hasConnection() {\n        return this.connections.length > 0;\n    }\n\n    addConnection(connection: Connection) {\n        if (!this.multipleConnections && this.hasConnection())\n            throw new Error('Multiple connections not allowed');\n        this.connections.push(connection);\n    }\n\n    addControl(control: Control) {\n        this.control = control;\n        control.parent = this;\n    }\n\n    showControl() {\n        return !this.hasConnection() && this.control !== null;\n    }\n\n    toJSON() {\n        return {\n            'connections': this.connections.map(c => {\n                return {\n                    node: c.output.node.id,\n                    output: c.output.node.outputs.indexOf(c.output)\n                };\n            })\n        };\n    }\n}","import { Connection } from './connection';\nimport { IO } from './io';\nimport { Input } from './input';\nimport { Socket } from './socket';\n\nexport class Output extends IO {\n  \n    constructor(title: string, socket: Socket, multiConns: boolean = true) {\n        super(title, socket, multiConns);\n    }\n    \n    hasConnection() {\n        return this.connections.length > 0;\n    }\n\n    connectTo(input: Input) {\n        if (!this.socket.compatibleWith(input.socket))\n            throw new Error('Sockets not compatible');\n        if (!input.multipleConnections && input.hasConnection())\n            throw new Error('Input already has one connection');\n        if (!this.multipleConnections && this.hasConnection())\n            throw new Error('Output already has one connection');\n\n        var connection = new Connection(this, input);\n\n        this.connections.push(connection);\n        return connection;\n    }\n\n    connectedTo(input: Input) {\n        return this.connections.some((item) => {\n            return item.input === input;\n        });\n    }\n\n    toJSON() {\n        return {\n            'connections': this.connections.map(c => {\n                return {\n                    node: c.input.node.id,\n                    input: c.input.node.inputs.indexOf(c.input)\n                }\n            })\n        };\n    }\n}","import { Block } from './block';\nimport { Component } from './component';\nimport { Control } from './control';\nimport { Input } from './input';\nimport { Output } from './output';\n\nexport class Node extends Block {\n   \n    constructor(title: string) {\n        super(Node);\n        this.group = null;\n        this.inputs = [];\n        this.outputs = [];\n        this.controls = [];\n        this.data = {};\n        this.readOnly = false;\n\n        this.title = title;\n        [this.width, this.height] = [180, 100];\n    }\n\n    addControl(control: Control, index: ?uint8 = null) {\n        control.parent = this;\n\n        if (index !== null)\n            this.controls.splice(index, 0, control);\n        else\n            this.controls.push(control);        \n        \n        return this;\n    }\n\n    addInput(input: Input, index: ?uint8 = null) {\n        if (input.node !== null)\n            throw new Error('Input has already been added to the node');\n\n        input.node = this;\n\n        if (index !== null)\n            this.inputs.splice(index, 0, input);\n        else\n            this.inputs.push(input);\n        \n        return this;\n    }\n\n    addOutput(output: Output, index: ?uint8 = null) {\n        if (output.node !== null)\n            throw new Error('Output has already been added to the node');\n        \n        output.node = this;\n\n        if (index !== null)\n            this.outputs.splice(index, 0, output);\n        else\n            this.outputs.push(output);\n\n        return this;\n    }\n\n    getConnections(type) {\n        var conns = [];\n\n        if (type==='input' || !type)\n            this.inputs.map(input => {\n                input.connections.forEach(c => {\n                    conns.push(c);\n                });\n            });\n        \n        if (type==='output' || !type)\n            this.outputs.forEach(output => {\n                output.connections.forEach(c => {\n                    conns.push(c);\n                });\n            });\n        return conns;\n    }\n\n    inputsWithVisibleControl() {\n        return this.inputs.filter((input)=> {\n            return input.showControl();\n        });\n    }\n\n    toJSON() {\n        return {\n            'id': this.id,\n            'data': this.data,\n            'group': this.group ? this.group.id : null,\n            'inputs': this.inputs.map(input => input.toJSON()),\n            'outputs': this.outputs.map(output => output.toJSON()),\n            'position': this.position,\n            'title': this.title\n        }\n    }\n\n    static async fromJSON(component: Component, json: Object) {\n        var node = component.newNode();\n\n        node.id = json.id;\n        node.data = json.data;\n        Node.latestId = Math.max(node.id, Node.latestId);\n        node.position = json.position;\n        node.title = json.title;\n\n        await component.builder(node);\n\n        return node;\n    }\n}\n","div.title\n  | {{node.title}}\n\n// Outputs\ndiv(al-repeat='output in node.outputs',style=\"text-align: right\")\n  .output-title\n    | {{output.title}}\n  .socket.output(\n    al-pick-output, \n    class=\"{{output.socket.id.toLowerCase().replace(' ','-')}}\",\n    title='{{output.socket.name}}\\n{{output.socket.hint}}'\n  )\n\n// Controls\ndiv.control(\n  al-repeat='control in node.controls', \n  style=\"text-align: center\",\n  :width='control.parent.width - 2 * control.margin', \n  :height='control.height', \n  al-control='control'\n)\n\n// Inputs\ndiv(al-repeat='input in node.inputs',style=\"text-align: left\")\n  .socket.input(\n    al-pick-input,\n    class=\"{{input.socket.id.toLowerCase().replace(' ','-')}} {{input.multipleConnections?'multiple':''}}\"\n    title='{{input.socket.name}}\\n{{input.socket.hint}}'\n  )\n  .input-title(\n    al-if='!input.showControl()'\n  )\n    | {{input.title}}\n  .input-control(\n    al-if='input.showControl()'\n    al-control='input.control'\n  )","import { ComponentWorker } from './component-worker';\nimport { Node } from './node';\nimport template from './templates/node.pug';\n\nvar defaultTemplate = template();\n\nexport class Component extends ComponentWorker {\n    constructor(name, props) {\n        super(name, props);\n        this.template = props.template || defaultTemplate;\n        this.builder = props.builder;\n        this.created = props.created || function () { }\n        this.destroyed = props.destroyed || function () { }\n    }\n\n    newNode() {\n        return new Node(this.name);\n    }\n}","import * as d3 from 'd3';\n\nexport function Group(scope, el, expression, env) {\n    var group = env.changeDetector.locals.group;\n    \n    function setPosition(item, dx, dy) {\n        const extent = this.editor.view.translateExtent;\n        const minx = extent[0][0];\n        const miny = extent[0][1];\n        const maxx = extent[1][0];\n        const maxy = extent[1][1];\n\n        item.position[0] = Math.min(maxx, Math.max(minx, item.position[0] + dx));\n        item.position[1] = Math.min(maxy, Math.max(miny, item.position[1] + dy));\n    }\n\n    group.el = el;\n    env.watch('group.style', () => {\n        Object.assign(el.style, group.style);\n    }, { deep: true });\n\n    d3.select(el).call(\n        d3.drag().on('start', () => {\n            if (!d3.event.sourceEvent.shiftKey)\n                this.editor.selectGroup(group, d3.event.sourceEvent.ctrlKey);\n        }).on('drag', () => {\n            if (this.editor.readOnly) return;\n\n            var k = this.transform.k;\n            var dx = d3.event.dx / k;\n            var dy = d3.event.dy / k;\n\n            this.editor.selected.each(item => {\n                setPosition.call(this, item, dx, dy);\n            });\n\n            this.editor.selected.eachGroup(item => {\n                for (var i in item.nodes) {\n                    let node = item.nodes[i];\n\n                    if (this.editor.selected.contains(node))\n                        continue;    \n\n                    setPosition.call(this, node, dx, dy);\n                }\n            });\n\n            this.update();\n        }).on('end', () => {\n            this.editor.eventListener.trigger('change');\n        })\n    );\n\n    var items = {\n        'Remove group': () => {\n            this.editor.removeGroup(group);\n        }\n    };\n\n    var onClick = (subitem) => {\n        subitem.call(this);\n        this.contextMenu.hide();\n    }\n\n    d3.select(el).on('contextmenu', () => {\n        if (this.editor.readOnly) return;\n        \n        var x = d3.event.clientX;\n        var y = d3.event.clientY;\n\n        this.editor.selectGroup(group);\n        this.contextMenu.show(x, y, items, false, onClick);\n        d3.event.preventDefault();\n    });\n}\n\nexport function GroupHandler(scope, el, arg, env) {\n    var group = env.changeDetector.locals.group;\n    var mousePrev = null;\n\n    function updateGroup(mouse, deltaw, deltah, deltax, deltay) {\n        if (deltaw !== 0)\n            mousePrev[0] = mouse[0];\n        if (deltah !== 0)\n            mousePrev[1] = mouse[1];\n        \n        if (arg.match('l')) {\n            group.position[0] += Math.min(deltaw, deltax);\n            group.setWidth(group.width - deltax);\n        }\n        else if (arg.match('r'))\n            group.setWidth(group.width + deltax);\n\n        if (arg.match('t')) {\n            group.position[1] += Math.min(deltah, deltay);\n            group.setHeight(group.height - deltay);\n        }\n        else if (arg.match('b'))\n            group.setHeight(group.height + deltay);\n    }\n\n    d3.select(el).call(d3.drag().on('start', () => {\n        mousePrev = d3.mouse(this.container.node());\n        this.editor.selectGroup(group);\n    }).on('drag', () => {\n        if (this.editor.readOnly) return;\n\n        var zoom = d3.zoomTransform(this.container);\n        var mouse = d3.mouse(this.container.node());\n        var deltax = (mouse[0] - mousePrev[0]) / zoom.k;\n        var deltay = (mouse[1] - mousePrev[1]) / zoom.k;\n        var deltaw = Math.max(0, group.width - group.minWidth);\n        var deltah = Math.max(0, group.height - group.minHeight);\n\n        updateGroup(mouse, deltaw, deltah, deltax, deltay);\n\n        this.update();\n    }).on('end', () => {\n        this.editor.nodes.forEach(node => {\n            if (group.isCoverNode(node))\n                group.addNode(node);\n            else\n                group.removeNode(node);\n        });\n\n        this.editor.eventListener.trigger('change');\n        this.update();\n    }))\n}\n\nexport function GroupTitle(scope, el, expression, env) {\n    var group = env.changeDetector.locals.group;\n\n    d3.select(el).on('click', () => {\n        var title = prompt('Please enter title of the group', group.title);\n\n        if (title !== null && title.length > 0)\n            group.title = title;\n        env.scan();\n    });\n}","import * as d3 from 'd3';\n\nexport function PickInput(scope, el, expression, env) {\n    var input = env.changeDetector.locals.input;\n\n    function interceptInput() {\n        if (this.pickedOutput === null) {\n            if (input.hasConnection()) {\n                this.pickedOutput = input.connections[0].output;\n                this.editor.removeConnection(input.connections[0]);\n            }\n            this.update();\n            return true;\n        }\n    }\n\n    function prepareConnection() {\n        if (!input.multipleConnections && input.hasConnection())\n            this.editor.removeConnection(input.connections[0]);\n        \n        if (!this.pickedOutput.multipleConnections && this.pickedOutput.hasConnection())\n            this.editor.removeConnection(this.pickedOutput.connections[0]);\n        \n        if (this.pickedOutput.connectedTo(input)) {\n            var connection = input.connections.find(c => c.output === this.pickedOutput);\n\n            this.editor.removeConnection(connection);\n        }\n\n        this.editor.connect(this.pickedOutput, input);\n    }\n\n    input.el = el;\n\n    let prevent = false;\n\n    d3.select(el).on('mouseleave', () => prevent = false);\n    d3.select(el).on('mousedown mouseup', () => {\n        if (this.editor.readOnly || prevent) return;\n        d3.event.preventDefault();\n        d3.event.stopPropagation();\n        \n        if (interceptInput.call(this)) return;\n        prepareConnection.call(this);\n\n        this.pickedOutput = null;\n    \n        this.update();\n    });\n    d3.select(el).on('mousedown.prevent', () => prevent = true);\n}\n\nexport function PickOutput(scope, el, expression, env) {\n    var output = env.changeDetector.locals.output;\n\n    output.el = el;\n\n    d3.select(el).on('mousedown', () => {\n        if (this.editor.readOnly) return;\n        d3.event.stopPropagation();\n\n        this.pickedOutput = output;\n    });\n}","function setAttributes(el, input, output) {\n    el.dataset.inputNode = input.node.id;\n    el.dataset.inputIndex = input.node.inputs.indexOf(input);\n    el.dataset.outputNode = output.node.id;\n    el.dataset.outputIndex = output.node.outputs.indexOf(output);\n    el.className.baseVal += ' output-'+output.socket.id.toLowerCase().replace(' ', '-');\n    el.className.baseVal += ' input-'+input.socket.id.toLowerCase().replace(' ', '-');\n}\n\nexport function Connection(scope, el, expression, env) {\n    var path = env.changeDetector.locals.path;\n    var connection = path.connection;\n\n    if (!connection) return;\n    \n    connection.el = el;\n    env.watch('path.connection.style', () => {\n        Object.assign(el.style, connection.style);\n    }, { deep: true });\n    \n    var input = path.connection.input;\n    var output = path.connection.output;\n\n    setAttributes(el, input, output);\n}","export function Control(scope, el, expression, env) {\n    var locals = env.changeDetector.locals;\n    var control = locals.input ? locals.input.control:locals.control;\n\n    el.innerHTML = control.html;\n    control.handler(el.children[0], control);\n}","import * as d3 from 'd3';\n\nexport function Item(scope, el, expression, env) {\n    var l = env.changeDetector.locals;\n    var item = l.subitem || l.item;\n    var haveSubitems = item.constructor === Object;\n\n    d3.select(el)\n        .on('click', () => {\n            if (!haveSubitems)\n                this.onClick(item);\n            d3.event.stopPropagation();\n        })\n        .classed('have-subitems', haveSubitems);\n}","export class Utils {\n\n    static nodesBBox(nodes) {\n        var min = (arr) => Math.min(...arr);\n        var max = (arr) => Math.max(...arr);\n\n        var left = min(nodes.map(node => node.position[0]));\n        var top = min(nodes.map(node => node.position[1]));\n        var right = max(nodes.map(node => node.position[0] + node.width));\n        var bottom = max(nodes.map(node => node.position[1] + node.height));\n        \n        return {\n            left,\n            right,\n            top,\n            bottom,\n            width: Math.abs(left - right),\n            height:  Math.abs(top - bottom),\n            getCenter: () => {\n                return [\n                    (left + right) / 2,\n                    (top + bottom) / 2\n                ];\n            }\n        };\n    }\n\n    static isValidData(data) {\n        return typeof data.id === 'string' &&\n            this.isValidId(data.id) &&\n            data.nodes instanceof Object && !(data.nodes instanceof Array) && \n            (!data.groups || data.groups instanceof Object)\n    }\n\n    static isValidId(id) {\n        return /^[\\w-]{3,}@[0-9]+\\.[0-9]+\\.[0-9]+$/.test(id);\n    }\n\n    static validate(id, data) {\n        var msg = '';\n        var id1 = id.split('@');\n        var id2 = data.id.split('@');\n\n        if (!this.isValidData(data))\n            msg += 'Data is not suitable. '; \n        if (id !== data.id)\n            msg += 'IDs not equal. ';\n        if (id1[0] !== id2[0])\n            msg += 'Names don\\'t match. ';\n        if (id1[1] !== id2[1])\n            msg += 'Versions don\\'t match';\n\n        return { success: msg ==='', msg };\n    }\n}","import { Block } from './block';\nimport { Node } from './node';\nimport { Utils } from './utils/common';\n\nexport class Group extends Block {\n\n    constructor(title: string, params: Object) {\n        super(Group);\n        this.title = title;\n\n        this.nodes = [];\n        this.setMinSizes(300, 250);\n\n        if (params.nodes)\n            this.coverNodes(params.nodes);\n        else {\n            this.position = params.position;\n            this.width = params.width;\n            this.height = params.height;\n        }\n    }\n\n    setMinSizes(width, height) {\n        this.minWidth = width;\n        this.minHeight = height;\n    }\n\n    setWidth(w: number) {\n        return this.width = Math.max(this.minWidth, w);\n    }\n\n    setHeight(h: number) {\n        return this.height = Math.max(this.minHeight, h);\n    }\n\n    isCoverNode(node: Node) {\n        var gp = this.position;\n        var np = node.position;\n\n        return np[0] > gp[0] && np[1] > gp[1]\n            && np[0] + node.width < gp[0] + this.width\n            && np[1] + node.height < gp[1] + this.height;\n    }\n\n    coverNodes(nodes: Node[]) {\n        var self = this;\n        var margin = 30;\n        var bbox = Utils.nodesBBox(nodes);\n\n        nodes.forEach(node => {\n            if (!node.readOnly) {\n                if (node.group !== null) node.group.removeNode(node.group);\n                self.addNode(node);\n            }\n        });\n        this.position = [bbox.left - margin, bbox.top - 2 * margin];\n        this.setWidth(bbox.right - bbox.left + 2 * margin);\n        this.setHeight(bbox.bottom - bbox.top + 3 * margin);\n    }\n\n    containNode(node: Node) {\n        return this.nodes.indexOf(node) !== -1;\n    }\n\n    addNode(node: Node) {\n        if (this.containNode(node)) return false;\n        if (node.group !== null) node.group.removeNode(node);\n        node.group = this;\n        this.nodes.push(node);\n        return true;\n    }\n\n    removeNode(node: Node) {\n        if (!this.containNode(node)) return;\n        this.nodes.splice(this.nodes.indexOf(node), 1);\n        node.group = null;\n    }\n\n    remove() {\n        this.nodes.forEach(node => {\n            node.group = null;\n        })\n    }\n\n    toJSON() {\n        return {\n            'id': this.id,\n            'title': this.title,\n            'nodes': this.nodes.map(a => a.id),\n            'minWidth': this.minWidth,\n            'minHeight': this.minHeight,\n            'position': this.position,\n            'width': this.width,\n            'height': this.height\n        }\n    }\n\n    static fromJSON(json: Object) {\n        var group = new Group(json.title, {\n            position: json.position,\n            width: json.width,\n            height: json.height\n        });\n\n        group.id = json.id;\n        Group.latestId = Math.max(group.id, Group.latestId);\n        group.minWidth = json.minWidth;\n        group.minHeight = json.minHeight;\n        return group;\n    }\n}\n","import * as d3 from 'd3';\nimport { Group } from '../group';\n\nexport function Node(scope, el, expression, env) {\n    var node = env.changeDetector.locals.node;\n\n    function setPosition(item, dx, dy) {\n        const extent = this.editor.view.translateExtent;\n        const minx = extent[0][0];\n        const miny = extent[0][1];\n        const maxx = extent[1][0];\n        const maxy = extent[1][1];\n\n        item.position[0] = Math.min(maxx, Math.max(minx, item.position[0] + dx));\n        item.position[1] = Math.min(maxy, Math.max(miny, item.position[1] + dy));\n    }\n        \n    node.el = el;\n    env.watch('node.style', () => {\n        Object.assign(el.style, node.style);\n    }, { deep: true });\n\n    d3.select(el).call(\n        d3.drag().on('start', () => {\n            d3.select(el).raise();\n            if (!d3.event.sourceEvent.shiftKey)\n                this.editor.selectNode(node, d3.event.sourceEvent.ctrlKey);\n        }).on('drag', () => {\n            if (this.editor.readOnly || node.readOnly) return;\n\n            var k = this.transform.k;\n            var dx = d3.event.dx / k;\n            var dy = d3.event.dy / k;\n\n            this.editor.selected.each(item => {\n                setPosition.call(this, item, dx, dy);\n            });\n\n            this.editor.selected.eachGroup(item => {\n                for (var i in item.nodes) {\n                    let _node = item.nodes[i];\n\n                    if (this.editor.selected.contains(_node))\n                        continue;    \n\n                    setPosition.call(this, _node, dx, dy);\n                }\n            });\n            \n            this.update();\n        }).on('end', () => {\n            this.editor.groups.forEach(group => {\n                this.editor.selected.eachNode(_node => {\n                    var contain = group.containNode(_node);\n                    var cover = group.isCoverNode(_node);\n\n                    if (contain && !cover)\n                        group.removeNode(_node);\n                    else if (!contain && cover)\n                        group.addNode(_node);\n                });\n            });\n\n            this.editor.eventListener.trigger('change');\n            this.update();\n        })\n    );\n\n    window.addEventListener('load', () => {\n        node.width = el.offsetWidth;\n        node.height = el.offsetHeight;\n    });\n\n    var items = {\n        'Remove node': () => {\n            this.editor.removeNode(node);\n        },\n        'Add to group': () => {\n            var group = new Group('Group', {nodes:[node]});\n\n            this.editor.addGroup(group);\n        }\n    };\n\n    var onClick = (subitem) => {\n        subitem.call(this);\n        this.contextMenu.hide();\n    }\n\n    d3.select(el).on('contextmenu', () => {\n        if (this.editor.readOnly || node.readOnly) return;\n\n        var x = d3.event.clientX;\n        var y = d3.event.clientY;\n\n        this.editor.selectNode(node);\n        this.contextMenu.show(x, y, items, false, onClick);\n        d3.event.preventDefault();\n    });\n}\n","import { Group, GroupHandler, GroupTitle } from './group';\nimport { PickInput, PickOutput } from './io';\nimport { Connection } from './connection';\nimport { Control } from './control';\nimport { Item } from './contextmenu';\nimport { Node } from './node';\n\nexport function declareViewDirectives(view, alight) {\n    \n    alight.directives.al.node = Node.bind(view);\n    \n    alight.directives.al.group = Group.bind(view);\n    alight.directives.al.groupHandler = GroupHandler.bind(view);\n    alight.directives.al.groupTitle = GroupTitle.bind(view);\n    \n    alight.directives.al.pickInput = PickInput.bind(view);\n    alight.directives.al.pickOutput = PickOutput.bind(view);\n        \n    alight.directives.al.control = Control.bind(view);\n\n    alight.directives.al.connection = Connection.bind(view);\n}\n\nexport function declareMenuDirectives(menu, alight) {\n    \n    alight.directives.al.item = Item.bind(menu);\n}",".context-menu(\n    :style.left='contextMenu.x+\"px\"',\n    :style.top='contextMenu.y+\"px\"',\n    @mouseleave='contextMenu.hide()',\n    al-if='contextMenu.visible'\n)\n  .search.item(al-if='contextMenu.searchBar')\n    input(al-value='filter')\n  .item(al-repeat='(name,item) in contextMenu.searchItems(filter)',\n    al-item\n    )\n    | {{name}}\n    .subitems(al-if='contextMenu.haveSubitems(item)')\n      .item(\n        al-repeat='(name,subitem) in item',\n        al-item\n      )\n        | {{name}}","import * as alight from 'alight';\nimport * as d3 from 'd3';\nimport { declareMenuDirectives } from './directives/index';\nimport template from './templates/menu.pug';\n\nexport class ContextMenu {\n\n    constructor(items: Object, searchBar: boolean = true, disabled = false) {\n        this.visible = false;\n        this.disabled = disabled;\n        this.x = 0;\n        this.y = 0;\n        this.default = {\n            items,\n            searchBar,\n            onClick() { throw new TypeError('onClick should be overrided');}\n        };\n\n        this.bindTemplate(template());\n    }\n\n    bindTemplate(t) {\n        this.dom = d3.select('body').append('div');\n        this.dom.node().setAttribute('tabindex', 1);\n        this.dom.html(t);\n\n        const alightInstance = alight.makeInstance();\n        \n        declareMenuDirectives(this, alightInstance);\n        this.$cd = alightInstance(this.dom.node(), {contextMenu: this});\n    }\n\n    searchItems(filter: ?string) {\n        var regex = new RegExp(filter, 'i'); \n        var items = {};\n\n        Object.keys(this.items).forEach(key => {\n            var item = this.items[key];\n\n            if (item.constructor === Object) {\n                var subitems = Object.keys(item).filter(subitem => regex.test(subitem))\n\n                if (subitems.length > 0) {\n                    items[key] = {};\n                    subitems.forEach(sumitem => {\n                        items[key][sumitem] = item[sumitem];\n                    });\n                }\n            }\n            \n            if (regex.test(key))\n                items[key] = item;\n        });\n\n        return items;\n    }\n\n    haveSubitems(item) {\n        return item.constructor === Object;\n    }\n\n    isVisible() {\n        return this.visible;\n    }\n\n    show(x: number, y: number, items: ?Object = null, searchBar: ?boolean = null, onClick = null) {\n        if (this.disabled) return;\n        \n        this.visible = true;\n        this.items = items || this.default.items;\n        this.searchBar = searchBar || this.default.searchBar;\n        this.onClick = onClick || this.default.onClick;\n        this.x = x;\n        this.y = y;\n        this.$cd.scan();\n    }\n\n    hide() {\n        this.visible = false;\n        this.$cd.scan();\n    }\n}","var p = (v) => parseInt(v);\nvar eqArr = (ar1, ar2) => ar1.every((v, i) => v === ar2[i]);\nvar eqObj = (o1, o2) => JSON.stringify(o1) === JSON.stringify(o2);\nvar eqCon = (c1, c2, target) => {\n    return c1.node === c2.node && c1[target] === c2[target];\n}\nvar diffCons = (cons1, cons2) => {\n\n    var removed = cons1.filter(c1 => !cons2.some(c2 => eqCon(c1, c2, 'input')));\n    var added = cons2.filter(c2 => !cons1.some(c1 => eqCon(c1, c2, 'input')));\n    \n    return {removed, added}\n}\n\nexport class Diff {\n\n    constructor(data1, data2) {\n        this.a = data1;\n        this.b = data2;\n    }\n\n    basicDiffs() {\n        var k1 = Object.keys(this.a.nodes);\n        var k2 = Object.keys(this.b.nodes);\n\n        var removed = k1.filter(k => !k2.includes(k)).map(p);\n        var added = k2.filter(k => !k1.includes(k)).map(p);\n        var stayed = k1.filter(k => k2.includes(k)).map(p);\n        \n        return { removed, added, stayed };\n    }\n\n    compare() {\n        var { removed, added, stayed } = this.basicDiffs();\n\n        var moved = stayed.filter(id => {\n            var p1 = this.a.nodes[id].position;\n            var p2 = this.b.nodes[id].position;\n\n            return !eqArr(p1, p2)\n        });\n\n        var datachanged = stayed.filter(id => {\n            var d1 = this.a.nodes[id].data;\n            var d2 = this.b.nodes[id].data;\n\n            return !eqObj(d1, d2);\n        });\n\n        var connects = stayed.reduce((arr, id) => {\n            var o1 = this.a.nodes[id].outputs;\n            var o2 = this.b.nodes[id].outputs;\n\n            var output = o1.map((out, i) => {\n                return Object.assign({output: i}, diffCons(out.connections, o2[i].connections))\n            }).filter(diff => diff.added.length !== 0 || diff.removed.length !== 0);\n\n            return [...arr, ...output.map(o => (o.node=id, o))];\n        }, [])\n\n        return {removed, added, moved, datachanged, connects}\n    }\n}","import { ComponentWorker } from './component-worker';\nimport { Utils } from './utils/common';\n\nvar State = { AVALIABLE:0, PROCESSED: 1, ABORT: 2};\n\nexport { ComponentWorker };\n\nexport class Engine {\n\n    constructor(id: string, components: ComponentWorker[]) {\n\n        if (!Utils.isValidId(id))\n            throw new Error('ID should be valid to name@0.1.0 format');  \n        \n        this.id = id;\n        this.components = components;\n        this.args = [];\n        this.data = null;\n        this.state = State.AVALIABLE;\n        this.onAbort = () => { };\n        this.onError = (message, data) => { console.error(message, data); };\n    }\n\n    clone() {\n        return new Engine(this.id, this.components);\n    }\n\n    async throwError (message, data = null) {\n        await this.abort();\n        this.onError(message, data);\n        this.processDone();\n\n        return 'error';\n    }\n\n    extractInputNodes(node, nodes) {\n        return node.inputs.reduce((a, inp) => {\n            return [...a, ...(inp.connections || []).reduce((b, c) => [...b, nodes[c.node]], [])]\n        }, []);\n    }\n\n    detectRecursions(nodes) {\n        const nodesArr = Object.keys(nodes).map(id => nodes[id]);\n        const findSelf = (node, inputNodes) => {\n            if (inputNodes.some(n => n === node))\n                return node;\n            \n            for (var i = 0; i < inputNodes.length; i++) {\n                if (findSelf(node, this.extractInputNodes(inputNodes[i], nodes)))\n                    return node;\n            }\n\n            return null;\n        }\n\n        return nodesArr.map(node => {\n            return findSelf(node, this.extractInputNodes(node, nodes))\n        }).filter(r => r !== null);\n    }\n\n    processStart() {\n        if (this.state === State.AVALIABLE) {  \n            this.state = State.PROCESSED;\n            return true;\n        }\n\n        if (this.state === State.ABORT) {\n            return false;\n        }\n\n        console.warn(`The process is busy and has not been restarted.\n                Use abort() to force it to complete`);\n        return false;\n    }\n\n    processDone() {\n        var success = this.state !== State.ABORT;\n\n        this.state = State.AVALIABLE;\n        \n        if (!success) {\n            this.onAbort();\n            this.onAbort = () => { }\n        }    \n\n        return success;\n    }\n\n    async abort() {\n        return new Promise(ret => {\n            if (this.state === State.PROCESSED) {\n                this.state = State.ABORT;\n                this.onAbort = ret;\n            }\n            else if (this.state === State.ABORT) {\n                this.onAbort();\n                this.onAbort = ret;\n            }\n            else\n                ret();\n        });\n    }\n\n    async lock(node) {\n        return new Promise(res => {\n            node.unlockPool = node.unlockPool || [];\n            if (node.busy && !node.outputData)\n                node.unlockPool.push(res);\n            else \n                res();\n            \n            node.busy = true;\n        });    \n    }\n\n    unlock(node) {\n        node.unlockPool.forEach(a => a());\n        node.unlockPool = [];\n        node.busy = false;\n    }\n\n    async extractInputData(node) {\n        return await Promise.all(node.inputs.map(async (input) => {\n            var conns = input.connections;\n            let connData = await Promise.all(conns.map(async (c) => {\n                const prevNode = this.data.nodes[c.node];\n\n                let outputs = await this.processNode(prevNode);\n\n                if (!outputs) \n                    this.abort();\n                else\n                    return outputs[c.output];\n            }));\n\n            return connData;\n        }));\n    }\n\n    async processWorker(node) {\n        var inputData = await this.extractInputData(node);\n        var component = this.components.find(c => c.name === node.title);\n        var outputData = node.outputs.map(() => null);\n\n        try {\n            await component.worker(node, inputData, outputData, ...this.args);\n        } catch (e) {\n            this.abort();\n            console.warn(e);\n        }\n\n        return outputData;\n    }\n\n    async processNode(node) {\n        if (this.state === State.ABORT || !node)\n            return null;\n        \n        await this.lock(node);\n\n        if (!node.outputData) {\n            node.outputData = this.processWorker(node)\n        }\n\n        this.unlock(node);\n        return node.outputData;\n    }\n\n    async forwardProcess(node) {\n        if (this.state === State.ABORT)\n            return null;\n\n        return await Promise.all(node.outputs.map(async (output) => {\n            return await Promise.all(output.connections.map(async (c) => {\n                const nextNode = this.data.nodes[c.node];\n\n                await this.processNode(nextNode);\n                await this.forwardProcess(nextNode);\n            }));\n        }));\n    }\n\n    copy(data) {\n        data = Object.assign({}, data);\n        data.nodes = Object.assign({}, data.nodes);\n        \n        Object.keys(data.nodes).forEach(key => {\n            data.nodes[key] = Object.assign({}, data.nodes[key])\n        });\n        return data;\n    }\n\n    async validate(data) {\n        var checking = Utils.validate(this.id, data);\n\n        if (!checking.success)\n            return await this.throwError(checking.msg);  \n        \n        var recurentNodes = this.detectRecursions(data.nodes);\n\n        if (recurentNodes.length > 0)\n            return await this.throwError('Recursion detected', recurentNodes);      \n         \n        return true;\n    }\n\n    async processStartNode(id) {\n        if (id) {\n            let startNode = this.data.nodes[id];\n\n            if (!startNode)\n                return await this.throwError('Node with such id not found');   \n            \n            await this.processNode(startNode);\n            await this.forwardProcess(startNode);\n        }\n    }\n\n    async processUnreachable() {\n        for (var i in this.data.nodes) // process nodes that have not been reached\n            if (typeof this.data.nodes[i].outputData === 'undefined') {\n                var node = this.data.nodes[i];\n\n                await this.processNode(node);\n                await this.forwardProcess(node);\n            }\n    }\n\n    async process(data: Object, startId: ?number = null, ...args) {\n        if (!this.processStart()) return;\n        if (!this.validate(data)) return;    \n        \n        this.data = this.copy(data);\n        this.args = args;\n\n        await this.processStartNode(startId);\n        await this.processUnreachable();\n        \n        return this.processDone()?'success':'aborted';\n    }\n}","import * as d3 from 'd3';\n\nexport class ViewUtils {\n\n    static getInputPosition(input) {\n        var node = input.node;\n        var el = input.el;\n\n        return [\n            node.position[0] + el.offsetLeft + el.offsetWidth / 2,\n            node.position[1] + el.offsetTop + el.offsetHeight / 2\n        ]\n    }\n\n    static getOutputPosition(output) {\n        var node = output.node;\n        var el = output.el;\n\n        return [\n            node.position[0] + el.offsetLeft + el.offsetWidth / 2,\n            node.position[1] + el.offsetTop + el.offsetHeight / 2\n        ]\n    }\n\n    static getConnectionPath(a, b, produce, pathInfo) {\n        var { points, curve } = produce(...a, ...b, pathInfo);\n\n        switch (curve) {\n        case 'linear': curve = d3.curveLinear; break;\n        case 'step': curve = d3.curveStep; break;\n        case 'basis': curve = d3.curveBasis; break;\n        default: curve = d3.curveBasis; break;\n        }\n        return this.pointsToPath(points, curve);\n    }\n\n    static pointsToPath(points, d3curve) {\n        var curve = d3curve(d3.path());\n        \n        curve.lineStart();\n        for (var i = 0; i < points.length;i++)\n            curve.point(...points[i]);\n        curve.lineEnd();\n\n        return curve._context.toString();\n    }\n}\n","// Groups\ndiv.group(al-repeat='group in editor.groups',\n  :style.transform='\"translate(\"+group.position[0]+\"px,\"+group.position[1]+\"px)\"',\n  :style.width='group.width+\"px\"',\n  :style.height='group.height+\"px\"',\n  al-group,\n  :class.selected='editor.selected.contains(group)'\n  )\n  div.group-title(al-group-title)\n    | {{group.title}}\n  div.group-handler.right.bottom(al-group-handler='rb')\n  div.group-handler.left.top(al-group-handler='lt')\n  div.group-handler.left.bottom(al-group-handler='lb')\n  div.group-handler.right.top(al-group-handler='rt')\n\n// Connections\nsvg.connections\n  path.connection(\n    al-repeat='path in editor.paths',\n    :d='path.d'\n    al-connection\n    :class.selected='path.selected'\n  )\n\n// Nodes\ndiv.node(al-repeat='node in editor.nodes',\n  :style.transform='\"translate(\"+node.position[0]+\"px,\"+node.position[1]+\"px)\"',\n  al-node,\n  :data-id=\"node.id\",\n  class=\"{{editor.selected.contains(node)?'selected':''}} {{node.title.toLowerCase().replace(' ','-')}}\"\n  )\n  div(al-html=\"editor.view.getTemplate(node)\")\n","import * as alight from 'alight';\nimport * as d3 from 'd3';\nimport { Utils, ViewUtils } from './utils/index';\nimport { Component } from './component';\nimport { ContextMenu } from './contextmenu';\nimport { Node } from './node';\nimport { NodeEditor } from './editor';\nimport { declareViewDirectives } from './directives/index';\nimport template from './templates/view.pug';\n\nconst zoomMargin = 0.9;\n\nexport class PathInfo {\n    constructor(output, input) {\n        this.connection = null;\n        this.input = input;\n        this.output = output;\n    }\n}\n\nexport class EditorView {\n\n    constructor(editor: NodeEditor, container: HTMLElement, menu: ?ContextMenu) {\n        this.editor = editor;\n        this.pickedOutput = null;\n        this.container = d3.select(container).attr('tabindex', 1);\n        this.mouse = [0, 0];\n        this.transform = d3.zoomIdentity;\n\n        this.contextMenu = menu || new ContextMenu({}, true, true);\n\n        this.initView();\n        this.initial();\n    }\n\n    initial() {\n        this.setScaleExtent(0.1, 1);\n        var size = Math.pow(2, 12);\n\n        this.setTranslateExtent(-size, -size, size, size);\n    }\n\n    initView() {\n        this.container\n            .on('click', () => {\n                if (this.container.node() === d3.event.target)\n                    this.areaClick()\n            });\n\n        this.view = this.container.append('div')\n            .style('transform-origin', '0 0')\n            .style('width', 1)\n            .style('height', 1);\n\n        this.zoom = d3.zoom()\n            .on('zoom', () => {\n                this.transform = d3.event.transform;\n                this.update();\n                this.editor.eventListener.trigger('transform', this.transform);\n            });\n\n        this.container.call(this.zoom);\n\n        d3.select(window)\n            .on('mousemove.d3ne' + this.editor._id, () => {\n                \n                var k = this.transform.k;\n                var position = d3.mouse(this.view.node());\n\n                this.mouse = [position[0]/k, position[1]/k];\n                this.update();\n            })\n            .on('keydown.d3ne' + this.editor._id, (e) => {\n                if (this.container.node() === document.activeElement)\n                    this.editor.keyDown(e);\n            })\n            .on('resize.d3ne' + this.editor._id, this.resize.bind(this));\n\n        this.view.html(template());\n        this.initAlight();\n    }\n\n    initAlight() {\n        var al = alight.makeInstance();\n\n        declareViewDirectives(this, al);\n        this.$cd = al(this.view.node(), { editor: this.editor });\n    }\n\n    getTemplate(node) {\n        var component = this.editor.components.find(c => {\n            return c.name === node.title\n        });\n\n        if (!component)\n            throw new Error(`Component not found. Make sure you have defined \n                            the component with the \"${node.title}\" name`);\n\n        return component.template;\n    }\n\n    resize() {\n        var width = this.container.node().parentElement.clientWidth;\n        var height = this.container.node().parentElement.clientHeight;\n\n        this.container\n            .style('width', width + 'px')\n            .style('height', height + 'px');\n\n        this.update();\n    }\n\n    connectionProducer(x1, y1, x2, y2) {\n        var offsetX = 0.3 * Math.abs(x1 - x2);\n        var offsetY = 0.1 * (y2 - y1);\n\n        var p1 = [x1, y1];\n        var p2 = [x1 + offsetX, y1 + offsetY];\n        var p3 = [x2 - offsetX, y2 - offsetY];\n        var p4 = [x2, y2];\n\n        return {\n            points: [p1, p2, p3, p4],\n            curve: 'basis'\n        };\n    }\n\n    updateConnections() {\n        var pathData = [];\n\n        this.editor.nodes.forEach(node => {\n            node.getConnections('output').forEach(con => {\n                let output = con.output;\n                let input = con.input;\n\n                if (input.el) {\n                    let pathInfo = new PathInfo(output, input);\n\n                    pathInfo.connection = con;\n\n                    pathData.push({\n                        connection: con,\n                        d: ViewUtils.getConnectionPath(\n                            ViewUtils.getOutputPosition(output),\n                            ViewUtils.getInputPosition(input),\n                            this.connectionProducer,\n                            pathInfo\n                        )\n                    });\n                }\n            });\n        });\n\n        if (this.pickedOutput !== null && this.pickedOutput.el) {\n            let output = this.pickedOutput;\n            let input = this.mouse;\n            let pathInfo = new PathInfo(output, input);\n\n            pathData.push({\n                selected: true,\n                d: ViewUtils.getConnectionPath(\n                    ViewUtils.getOutputPosition(output),\n                    input,\n                    this.connectionProducer,\n                    pathInfo\n                )\n            });\n        }\n\n        this.editor.paths = pathData;\n    }\n\n    update() {\n        var t = this.transform;\n        \n        this.view.style('transform', `translate(${t.x}px, ${t.y}px) scale(${t.k})`);\n        this.updateConnections();\n        this.$cd.scan();\n    }\n\n    assignContextMenuHandler() {\n        this.contextMenu.default.onClick = async (item) => {\n        \n            if (item instanceof Component) {\n                let node = item.newNode();\n\n                await item.builder(node);\n                this.editor.addNode(node, true);\n                this.editor.selectNode(node);\n            }\n            else\n                item();\n\n            this.contextMenu.hide();\n        };\n    }    \n\n    areaClick() {\n        if (this.editor.readOnly) return;\n        \n        if (this.pickedOutput !== null && !d3.event.ctrlKey)\n            this.pickedOutput = null;\n        else if (this.contextMenu.visible)\n            this.contextMenu.hide();\n        else {\n            this.assignContextMenuHandler();\n            this.contextMenu.show(d3.event.pageX, d3.event.pageY);\n        }\n        this.update();\n    }\n\n    zoomAt(nodes: Node[]) {\n        if (nodes.length === 0) return;\n\n        var [w, h] = [this.container.node().clientWidth, this.container.node().clientHeight];\n        var bbox = Utils.nodesBBox(nodes);\n        var [kw, kh] = [w / bbox.width, h / bbox.height]\n        var k = Math.min(kh, kw, 1) * zoomMargin;\n\n        var center = bbox.getCenter();\n\n        this.translate(w / 2 - center[0] * k, h / 2 - center[1] * k);\n        this.scale(k);\n    }\n\n    translate(x, y) {\n        this.transform.x = x;\n        this.transform.y = y;\n        this.update();\n    }\n\n    scale(scale) {\n        this.transform.k = scale;\n        this.update();\n    }\n\n    setScaleExtent(scaleMin: number, scaleMax: number) {\n        this.scaleExtent = [scaleMin, scaleMax];\n        this.zoom.scaleExtent(this.scaleExtent);\n    }\n\n    setTranslateExtent(left: number, top: number, right: number, bottom: number) {\n        this.translateExtent = [[left, top], [right, bottom]];\n        this.zoom.translateExtent(this.translateExtent);\n    }\n\n    destroy() {\n        d3.select(window)\n            .on('mousemove.d3ne' + this.editor._id, null)\n            .on('keydown.d3ne' + this.editor._id, null)\n            .on('resize.d3ne' + this.editor._id, null);\n    }\n}\n","export class EventListener {\n\n    constructor() {\n        this.events = {\n            nodecreate:[],\n            groupcreate: [],\n            connectioncreate: [],\n            noderemove:[],\n            groupremove:[],\n            connectionremove:[],\n            nodeselect:[],\n            groupselect: [],\n            error: [console.warn],\n            change: [],\n            transform: []\n        };\n        this.persistent = true;\n    }\n\n    on(names: string, handler: () => {}) { \n\n        names.split(' ').forEach(name => {\n            if (!this.events[name])\n                throw new Error(`The event ${name} does not exist`); \n            this.events[name].push(handler);\n        });\n        \n        return this;\n    }\n\n    trigger(name: string, param) {\n\n        if (!(name in this.events))\n            throw new Error(`The event ${name} cannot be triggered`);\n        \n        return this.events[name].reduce((r, e) => {\n            return (e(param, this.persistent) !== false) && r\n        }, true); // return false if at least one event is false        \n    }\n}","class Command {\n    constructor(exec, undo, args) {\n        this.exec = () => { exec(...args) };\n        this.undo = () => { undo(...args) };\n        this.a = args[0];\n    }\n}\n\nexport class History {\n\n    constructor(editor) {\n        this.editor = editor;\n        this.list = [];\n        this._locked = false;\n        this.position = -1;\n    }\n\n    add(exec, undo, args) {\n        if (this._locked) return;\n        \n        this.position++;\n        this.list.splice(this.position);\n        this.list.push(new Command(exec, undo, args));\n    }\n\n    undo() {\n        if (this.position < 0) return;\n\n        this._locked = true;\n        this.list[this.position--].undo();\n        this._locked = false;\n    }\n\n    redo() {\n        if (this.position + 1 >= this.list.length) return;\n        \n        this._locked = true;\n        this.list[++this.position].exec();\n        this._locked = false;\n    }\n}","import { Group } from './group';\nimport { Node } from './node';\n\nexport class Selected {\n\n    constructor() {\n        this.list = [];\n    }\n\n    add(item: Node | Group, accumulate = false) {\n        if (accumulate) {\n            if (this.contains(item))\n                this.remove(item);\n            else\n                this.list.push(item);\n        }\n        else\n            this.list = [item];    \n    }\n\n    clear() {\n        this.each(item => {\n            this.remove(item);\n        });\n    }\n\n    remove(item) {\n        this.list.splice(this.list.indexOf(item), 1);\n    }\n\n    contains(item) {\n        return this.list.indexOf(item) !== -1;\n    }\n\n    each(callback) {\n        this.list.forEach(callback);\n    }\n\n    eachNode(callback) {\n        this.list.filter(item => item instanceof Node).forEach(callback);\n    }\n\n    eachGroup(callback) {\n        this.list.filter(item => item instanceof Group).forEach(callback);\n    }\n\n    getNodes() {\n        return this.list.filter(item => item instanceof Node);\n    }\n\n    getGroups() {\n        return this.list.filter(item => item instanceof Group);\n    }\n}","import * as d3 from 'd3';\nimport { Component } from './component';\nimport { Connection } from './connection';\nimport { ContextMenu } from './contextmenu';\nimport { EditorView } from './editorview';\nimport { EventListener } from './eventlistener';\nimport { Group } from './group';\nimport { History } from './history';\nimport { Input } from './input';\nimport { Node } from './node';\nimport { Output } from './output';\nimport { Selected } from './selected';\nimport { Utils } from './utils/common';\n\nexport class NodeEditor {\n\n    constructor(id: string, container: HTMLElement, components: Component[], menu: ?ContextMenu) {\n\n        if (!Utils.isValidId(id))\n            throw new Error('ID should be valid to name@0.1.0 format');  \n        \n        this.id = id;\n        this.components = components;\n\n        this.init();\n\n        this.view = new EditorView(this, container, menu);\n        this.view.resize();\n    }\n\n    init() {\n        this._id = Math.random().toString(36).substr(2, 9);\n        this.eventListener = new EventListener();\n        this.selected = new Selected();\n        this.history = new History(this);\n        \n        this.nodes = [];\n        this.groups = [];\n        this.readOnly = false;\n    }\n\n    addNode(node: Node, mousePlaced = false) {\n        if (this.eventListener.trigger('nodecreate', node)) {\n            if (mousePlaced)\n                node.position = this.view.mouse;\n            this.nodes.push(node);\n            this.findComponent(node).created(node);\n            this.eventListener.trigger('change');\n            \n            this.history.add(this.addNode.bind(this),\n                this.removeNode.bind(this),\n                [node]);\n        }\n    }\n\n    addGroup(group: Group) {\n        if (this.eventListener.trigger('groupcreate', group)) {\n            this.groups.push(group);\n            this.eventListener.trigger('change');\n        }\n        \n        this.view.update();\n    }\n\n    removeNode(node: Node) {\n        if (node.readOnly) return;\n        var index = this.nodes.indexOf(node);\n\n        if (this.eventListener.trigger('noderemove', node)) {\n            node.getConnections().forEach(c => this.removeConnection(c));\n\n            this.nodes.splice(index, 1);\n            this.findComponent(node).destroyed(node);\n            this.eventListener.trigger('change');\n\n            this.history.add(this.removeNode.bind(this),\n                this.addNode.bind(this),\n                [node]);\n        }\n\n        this.view.update();\n    }\n\n    removeGroup(group: Group) {\n        if (this.eventListener.trigger('groupremove', group)) {\n            group.remove();\n            this.groups.splice(this.groups.indexOf(group), 1);\n            this.eventListener.trigger('change');\n        }    \n\n        this.view.update(); \n    }\n\n    connect(output: Output | Connection, input: ?Input) {\n        if (output instanceof Connection) {\n            input = output.input;\n            output = output.output;\n        }\n\n        if (this.eventListener.trigger('connectioncreate', { output, input })) {\n            try {\n                var connection = output.connectTo(input);\n\n                this.eventListener.trigger('change');\n                this.history.add(this.connect.bind(this),\n                    this.removeConnection.bind(this),\n                    [connection]);\n            } catch (e) {\n                this.eventListener.trigger('error', e);\n            }\n        }\n        this.view.update(); \n    }\n\n    removeConnection(connection: Connection) {\n        if (this.eventListener.trigger('connectionremove', connection)) {\n            connection.remove();\n            this.eventListener.trigger('change');\n\n            this.history.add(this.removeConnection.bind(this),\n                this.connect.bind(this),\n                [connection]);\n        }\n        this.view.update(); \n    }\n\n    selectNode(node: Node, accumulate: boolean = false) {\n        if (this.nodes.indexOf(node) === -1)\n            throw new Error('Node not exist in list');\n        \n        if (this.eventListener.trigger('nodeselect', node))\n            this.selected.add(node, accumulate);\n        \n        this.view.update();\n    }\n\n    selectGroup(group: Group, accumulate: boolean = false) {\n        if (this.groups.indexOf(group) === -1)\n            throw new Error('Group not exist in list');\n        \n        if (this.eventListener.trigger('groupselect', group))\n            this.selected.add(group, accumulate);\n        \n        this.view.update();\n    }\n    \n    keyDown() {\n        if (this.readOnly) return;\n\n        switch (d3.event.keyCode) {\n        case 46:\n            this.selected.eachNode(this.removeNode.bind(this));\n            this.selected.eachGroup(this.removeGroup.bind(this));\n            this.view.update();\n            break;\n        case 71:\n            let nodes = this.selected.getNodes();\n                \n            if (nodes.length > 0)\n                this.addGroup(new Group('Group', { nodes }));\n            \n            break;\n        case 90:\n            if (d3.event.ctrlKey && d3.event.shiftKey)\n                this.history.redo();\n            else\n            if (d3.event.ctrlKey)\n                this.history.undo();\n                \n            break;\n        default: break;\n            \n        }\n    }\n\n    findComponent(node) {\n        const component = this.components.find(c => {\n            return c.name === node.title\n        });\n\n        if (!component) throw `Component ${node.title} was not found`;\n\n        return component;\n    }\n\n    clear() {\n        this.nodes.splice(0, this.nodes.length);\n        this.groups.splice(0, this.groups.length);\n    }\n\n    toJSON() {\n        var nodes = {};\n        var groups = {};\n\n        this.nodes.forEach(node => nodes[node.id] = node.toJSON());\n        this.groups.forEach(group => groups[group.id] = group.toJSON());\n\n        return {\n            'id': this.id,\n            'nodes': nodes,\n            'groups': groups\n        };\n    }\n\n    beforeImport(json: Object) {\n        var checking = Utils.validate(this.id, json);\n        \n        if (!checking.success) {\n            this.eventListener.trigger('error', checking.msg);\n            return false;\n        }\n        \n        this.eventListener.persistent = false;\n        this.clear();\n        return true;\n    }\n\n    afterImport() {\n        this.view.update();\n        this.eventListener.persistent = true;\n        return true;\n    }\n\n    async fromJSON(json: Object) {\n        if (!this.beforeImport(json)) return false;\n        var nodes = {};\n\n        try {\n            await Promise.all(Object.keys(json.nodes).map(async id => {\n                var node = json.nodes[id];\n                var component = this.findComponent(node);\n\n                nodes[id] = await Node.fromJSON(component, node);\n                this.addNode(nodes[id]);\n            }));\n        \n            Object.keys(json.nodes).forEach(id => {\n                var jsonNode = json.nodes[id];\n                var node = nodes[id];\n                \n                jsonNode.outputs.forEach((outputJson, i) => {\n                    outputJson.connections.forEach(jsonConnection => {\n                        var nodeId = jsonConnection.node;\n                        var inputIndex = jsonConnection.input;\n                        var targetInput = nodes[nodeId].inputs[inputIndex];\n\n                        this.connect(node.outputs[i], targetInput);\n                    });\n                });\n\n            });\n\n            if (typeof json.groups === 'object')\n                Object.keys(json.groups).forEach(id => {\n                    var group = Group.fromJSON(json.groups[id]);\n\n                    json.groups[id].nodes.forEach(nodeId => {\n                        var node = nodes[nodeId];\n\n                        group.addNode(node);\n                    })\n                    this.addGroup(group);\n                });\n        }\n        catch (e) {\n            this.eventListener.trigger('error', e);\n            return false;\n        }\n        return this.afterImport();\n    }\n}\n","export class Task {\n\n    constructor(inputs, action) {\n        this.inputs = inputs;\n        this.action = action;\n        this.next = [];\n        this.outputData = null;\n        this.closed = [];\n\n        this.getOptions().forEach(input => {\n            input.forEach(con => {\n                con.task.next.push({index: con.index, task: this});\n            })\n        });\n    }\n\n    getOptions() {\n        return this.inputs.filter(input => input[0] && input[0].task)\n    }\n\n    getOutputs() {\n        return this.inputs.filter(input => input[0] && input[0].get);\n    }\n\n    reset() {\n        this.outputData = null;\n    }\n\n    async run(data, needReset = true, garbage = []) {\n        garbage.push(this);\n\n        var inputs = await Promise.all(this.getOutputs().map(async input => {\n            return await Promise.all(input.map(async con => {\n                if (con) {\n                    await con.run(data, false, garbage);\n                    return con.get();\n                }\n            }));\n        }));\n\n        if (!this.outputData) {\n            this.outputData = await this.action(inputs, data);\n\n            await Promise.all(\n                this.next\n                    .filter(f => !this.closed.includes(f.index))\n                    .map(async f => \n                        await f.task.run(data, false, garbage)\n                    )\n            );\n        }\n        \n        if (needReset)\n            garbage.map(t => t.reset());\n    }\n\n    option(index) {\n        var task = this;\n\n        return {task, index}\n    }\n\n    output(index) {\n        var task = this;\n\n        return {\n            run: task.run.bind(task),\n            get() {\n                return task.outputData[index];\n            }\n        }\n    }\n}"],"names":["Module","data","titlesInput","titlesOutput","inputs","extractNodes","outputs","keys","map","n","name","input","forEach","key","i","output","k","titles","Object","nodes","filter","includes","title","sort","n1","n2","position","ModuleManager","engine","node","module","clone","read","process","m","write","ComponentWorker","props","worker","Block","Class","constructor","TypeError","id","incrementId","width","height","style","latestId","Control","html","handler","parent","Error","Node","getNode","Connection","addConnection","removeConnection","IO","socket","multiConns","multipleConnections","connections","connection","splice","indexOf","Socket","hint","compatible","push","Input","control","length","hasConnection","c","Output","compatibleWith","some","item","group","controls","readOnly","index","type","conns","showControl","toJSON","component","json","Component","newNode","Math","max","builder","defaultTemplate","template","created","destroyed","Group","scope","el","expression","env","changeDetector","locals","setPosition","dx","dy","extent","editor","view","translateExtent","minx","miny","maxx","maxy","min","watch","assign","deep","call","d3","on","sourceEvent","shiftKey","selectGroup","ctrlKey","transform","selected","each","eachGroup","contains","update","eventListener","trigger","items","removeGroup","onClick","subitem","contextMenu","hide","x","clientX","y","clientY","show","preventDefault","GroupHandler","arg","mousePrev","updateGroup","mouse","deltaw","deltah","deltax","deltay","match","setWidth","setHeight","container","zoom","minWidth","minHeight","isCoverNode","addNode","removeNode","GroupTitle","prompt","scan","PickInput","interceptInput","pickedOutput","prepareConnection","connectedTo","find","connect","prevent","stopPropagation","PickOutput","setAttributes","dataset","inputNode","inputIndex","outputNode","outputIndex","className","baseVal","toLowerCase","replace","path","innerHTML","children","Item","l","haveSubitems","classed","Utils","arr","left","top","right","bottom","abs","isValidId","Array","groups","test","msg","id1","split","id2","isValidData","success","params","setMinSizes","coverNodes","w","h","gp","np","self","margin","bbox","nodesBBox","containNode","a","raise","selectNode","_node","eachNode","contain","cover","addEventListener","offsetWidth","offsetHeight","addGroup","declareViewDirectives","alight","directives","al","bind","groupHandler","groupTitle","pickInput","pickOutput","declareMenuDirectives","menu","ContextMenu","searchBar","disabled","visible","default","bindTemplate","t","dom","append","setAttribute","alightInstance","$cd","regex","RegExp","subitems","sumitem","p","v","parseInt","eqArr","ar1","ar2","every","eqObj","o1","o2","JSON","stringify","eqCon","c1","c2","target","diffCons","cons1","cons2","removed","added","Diff","data1","data2","b","k1","k2","stayed","basicDiffs","moved","p1","p2","datachanged","d1","d2","connects","reduce","out","diff","o","State","AVALIABLE","PROCESSED","ABORT","Engine","components","args","state","onAbort","onError","message","error","abort","processDone","inp","nodesArr","findSelf","inputNodes","extractInputNodes","r","warn","Promise","ret","unlockPool","busy","outputData","res","all","processNode","prevNode","connData","extractInputData","inputData","lock","processWorker","unlock","nextNode","forwardProcess","validate","checking","throwError","detectRecursions","recurentNodes","startNode","startId","processStart","copy","processStartNode","processUnreachable","ViewUtils","offsetLeft","offsetTop","produce","pathInfo","points","curve","pointsToPath","d3curve","lineStart","point","lineEnd","_context","toString","zoomMargin","PathInfo","EditorView","NodeEditor","HTMLElement","attr","initView","initial","setScaleExtent","size","pow","setTranslateExtent","areaClick","window","_id","e","document","activeElement","keyDown","resize","initAlight","parentElement","clientWidth","clientHeight","x1","y1","x2","y2","offsetX","offsetY","p3","p4","pathData","getConnections","con","getConnectionPath","getOutputPosition","getInputPosition","connectionProducer","paths","updateConnections","assignContextMenuHandler","pageX","pageY","kw","kh","center","getCenter","translate","scale","scaleMin","scaleMax","scaleExtent","EventListener","events","console","persistent","names","param","Command","exec","undo","History","list","_locked","Selected","accumulate","remove","callback","init","random","substr","history","mousePlaced","findComponent","add","connectTo","keyCode","getNodes","redo","clear","beforeImport","fromJSON","jsonNode","outputJson","nodeId","jsonConnection","targetInput","babelHelpers.typeof","afterImport","Task","action","next","closed","getOptions","task","get","needReset","garbage","getOutputs","run","f","reset"],"mappings":"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"}